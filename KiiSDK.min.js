!function(){var e=function(){Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=i.length;return function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var s=[];for(var o in r)e.call(r,o)&&s.push(o);if(t)for(var u=0;n>u;u++)e.call(r,i[u])&&s.push(i[u]);return s}}());var e,t,i,n,r,s,o,u,a,h,l,c,p=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty,_=function(e,t){function i(){this.constructor=e}for(var n in t)d.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};return h="undefined"!=typeof exports&&null!==exports?new Object:this,h.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2,QQ:3},h.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api"},h.Kii=function(){function e(){}var t,n;return n=null,t=null,e.getBuildNumber=function(){return"1"},e.getSDKVersion=function(){return"2.1.26"},e.getBaseURL=function(){return n._baseURL},e.getAppID=function(){return n._appID},e.getAdditionalHeaders=function(){return t},e.setAdditionalHeaders=function(e){return t=e},e.getAppKey=function(){return n._appKey},e.isLogging=function(){return n._logging},e.setLogging=function(e){return n._logging=e,h.Kii.logger("Setting logging: "+e),h.Kii.logger("Base URL: "+n._baseURL)},e.setAccessTokenExpiration=function(e){if(!n)throw new h.IllegalStateException("Kii is not initialized");if(isNaN(parseInt(e,10)))throw new h.InvalidArgumentException("expiresIn should be a number");if(0>e)throw new h.InvalidArgumentException("expiresIn should not negative number");return n?n._expiresIn=e:void 0},e.getAccessTokenExpiration=function(){if(!n)throw new h.IllegalStateException("Kii is not initialized");return n._expiresIn},e.initializeWithSite=function(e,t,i){return n=new l(e,t,i),h.Kii.logger("Initialized "+e+", "+t+", "+i)},e.initialize=function(e,t){return h.Kii.initializeWithSite(e,t,h.KiiSite.US)},e.logger=function(e){return n._logging?console.log(e):void 0},e.bucketWithName=function(e){var t;return t=new h.KiiBucket(e,null)},e.encryptedBucketWithName=function(e){var t;return t=new h.KiiEncryptedBucket(e,null)},e.groupWithName=function(e){return new h.Kii.groupWithNameAndMembers(e,null)},e.groupWithNameAndMembers=function(e,t){return new h.KiiGroup.groupWithNameAndMembers(e,t)},e.logOut=function(){return n._currentUser=null,h.KiiSocialConnect.logOutAll()},e.loggedIn=function(){return null!=n._currentUser},e.getCurrentUser=function(){var e;return null!=n._currentUser?(e=new h.KiiUser,e._uuid=n._currentUser._uuid,e._username=n._currentUser._username,e._displayName=n._currentUser._displayName,e._password=n._currentUser._password,e._emailAddress=n._currentUser._emailAddress,e._phoneNumber=n._currentUser._phoneNumber,e._country=n._currentUser._country,e._created=n._currentUser._created,e._modified=n._currentUser._modified,e._emailVerified=n._currentUser._emailVerified,e._phoneVerified=n._currentUser._phoneVerified,e._accessToken=n._currentUser._accessToken,e._customInfo=n._currentUser._customInfo,e._expiresAt=n._currentUser._expiresAt,e._thirdPartyAccounts=n._currentUser._thirdPartyAccounts,e._disabled=n._currentUser._disabled,h.Kii.logger("my instance:"),h.Kii.logger(e),e):null},e.setCurrentUser=function(e){return n._currentUser=new h.KiiUser,n._currentUser._uuid=e._uuid,n._currentUser._username=e._username,n._currentUser._displayName=e._displayName,n._currentUser._password=e._password,n._currentUser._emailAddress=e._emailAddress,n._currentUser._phoneNumber=e._phoneNumber,n._currentUser._country=e._country,n._currentUser._created=e._created,n._currentUser._modified=e._modified,n._currentUser._emailVerified=e._emailVerified,n._currentUser._phoneVerified=e._phoneVerified,n._currentUser._accessToken=e._accessToken,n._currentUser._customInfo=e._customInfo,n._currentUser._expiresAt=e._expiresAt,n._currentUser._thirdPartyAccounts=e._thirdPartyAccounts,n._currentUser._disabled=e._disabled,h.Kii.logger("my instance:"),h.Kii.logger(n._currentUser)},e.authenticateAsAppAdmin=function(e,t,n){var r,s;return s=new i("/oauth2/token",!1),s.setAnonymous(!0),s.setMethod("POST"),s.setData({client_id:e,client_secret:t}),r={success:function(){return function(e){var t,i,r;return r=e.access_token,i=e.id,h.Kii.logger("token: "+r),h.Kii.logger("id: "+i),t=new h.KiiAppAdminContext({token:r,id:i}),null!=n?n.success(t):void 0}}(this),failure:function(){return function(e,t){return h.Kii.logger("error: "+e),h.Kii.logger("statusCode: "+t),null!=n?n.failure(e,t):void 0}}(this)},s.execute(r,!1)},e.authenticateAsAdminWithToken=function(e){return new h.KiiAppAdminContext({token:e})},e.serverCodeEntry=function(e){if(!s._validateServerCodeEntryName(e))throw new h.InvalidArgumentException("entryName is invalid");return new h.KiiServerCodeEntry(e)},e.serverCodeEntryWithVersion=function(e,t){if(!s._validateServerCodeEntryName(e))throw new h.InvalidArgumentException("entryName is invalid");if(!s._validateServerCodeEnryVersion(t))throw new h.InvalidArgumentException("version is invalid");return new h.KiiServerCodeEntry(e,t)},e._setHttpRequestType=function(e){return h.Kii.logger("Set http request as "+e),n._httpRequestType=e},e._getHttpRequestType=function(){return n._httpRequestType},e}(),h._KiiHttpRequestType={jQuery:"jQuery",XMLHttpRequest:"XMLHttpRequest",Titanium:"Titanium"},l=function(){function e(e,t,i){this._appKey=t,this._appID=e,this._baseURL=i,this._expiresIn=0}return e.prototype._logging=!1,e.prototype._baseURL=null,e.prototype._currentUser=null,e.prototype._httpRequestType=null,e}(),h.KiiACL=function(){function e(){this._userWithID=p(this._userWithID,this),this._groupWithID=p(this._groupWithID,this),this._getRequest=p(this._getRequest,this),this._saveItr=p(this._saveItr,this),this.save=p(this.save,this),this._getKeyOfEntry=p(this._getKeyOfEntry,this),this.removeACLEntry=p(this.removeACLEntry,this),this.putACLEntry=p(this.putACLEntry,this),this.listACLEntries=p(this.listACLEntries,this),this.aclPath=p(this.aclPath,this),this._setParent=p(this._setParent,this),this._entriesMap={}}return e.prototype._setParent=function(e){this._parent=e},e.prototype.aclPath=function(){var e,t,i,n,r,s,o;return this._parent instanceof h.KiiObject?(n=this._parent,null!=n.getBucket().getUser()?o=n.getBucket().getUser():null!=n.getBucket().getGroup()&&(i=n.getBucket().getGroup()),t=n.getBucket()._getQualifiedBucketName(),r=n.getUUID()):this._parent instanceof h.KiiBucket?(e=this._parent,null!=e.getUser()?o=e.getUser():null!=e.getGroup()&&(i=e.getGroup()),t=e._getQualifiedBucketName()):h.Kii.logger("Invalid ACL parent. Must belong to a KiiObject"),s="/",null!=i?s+="groups/"+i.getUUID()+"/":null!=o&&(s+="users/"+o.getUUID()+"/"),s+=null!=r?"buckets/"+t+"/objects/"+r+"/acl":"buckets/"+t+"/acl"},e.prototype.listACLEntries=function(e){var t,i;return h.Kii.logger("Listing ACL entries"),i=this._getRequest({path:this.aclPath(),withApp:!0}),t={success:function(t){return function(i,n){var r,s,o,u,a,l,c,p;if(300>n&&n>=200){u=[];for(o in i)for(l=i[o],"WRITE_EXISTING_OBJECT"===o?r=h.KiiACLAction.KiiACLObjectActionWrite:"READ_EXISTING_OBJECT"===o?r=h.KiiACLAction.KiiACLObjectActionRead:"QUERY_OBJECTS_IN_BUCKET"===o?r=h.KiiACLAction.KiiACLBucketActionQueryObjects:"CREATE_OBJECTS_IN_BUCKET"===o?r=h.KiiACLAction.KiiACLBucketActionCreateObjects:"DROP_BUCKET_WITH_ALL_CONTENT"===o&&(r=h.KiiACLAction.KiiACLBucketActionDropBucket),c=0,p=l.length;p>c;c++)s=l[c],null!=s.groupID?a=t._groupWithID(s.groupID):null!=s.userID&&(a=t._userWithID(s.userID)),u.push(h.KiiACLEntry.entryWithSubject(a,r));return e.success(t,u)}return e.failure(t,"Unable to retrieve ACL list")}}(this),failure:function(t){return function(i){return e.failure(t,i)}}(this)},i.execute(t,!1)},e.prototype.putACLEntry=function(e){var t;if(!(e instanceof h.KiiACLEntry))throw new h.InvalidArgumentException("invalid entry");return t=this._getKeyOfEntry(e),this._entriesMap[t]=e},e.prototype.removeACLEntry=function(e){var t;if(!(e instanceof h.KiiACLEntry))throw new h.InvalidArgumentException("invalid entry");return t=this._getKeyOfEntry(e),delete this._entriesMap[t]},e.prototype._getKeyOfEntry=function(e){var t,i,n;return t=e.getActionString(),i=e.getEntityString(),n=e.getGrant(),""+t+"/"+i+":"+n},e.prototype.save=function(e){var t;return h.Kii.logger("SAving acl"),this._entriesMap?(t=Object.keys(this._entriesMap),h.Kii.logger("Saving total entries : "+t.length),t.length<1?void e.failure(this,"There is no entry to save."):this._saveItr(t,0,e)):void e.failure(this,"There is no entry to save.")},e.prototype._saveItr=function(e,t,i){var n,r,s,o;return n=this._entriesMap[e[t]],r=""+this.aclPath()+"/"+n.getActionString()+"/"+n.getEntityString(),h.Kii.logger("Saving single @path: "+r),h.Kii.logger("Saving  entries index : "+t),s=this._getRequest({path:r,withApp:!0}),s.setMethod(n.getGrant()===!0?"PUT":"DELETE"),o=null,s.execute({success:function(r){return function(){return r.removeACLEntry(n),t<e.length-1?r._saveItr(e,t+1,i):i.success(r)}}(this),failure:function(e){return function(t){return i.failure(e,t)}}(this)},!1)},e.aclWithParent=function(e){var t;return t=new h.KiiACL,t._setParent(e),t},e.prototype._getRequest=function(e){var t,n,r;return t=e.path,r=e.withApp,n=new i(t,r)},e.prototype._groupWithID=function(e){var t;return t=h.KiiGroup.groupWithID(e)},e.prototype._userWithID=function(e){var t;return t=h.KiiUser.userWithID(e)},e}(),h.KiiACLAction={KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLObjectActionRead:3,KiiACLObjectActionWrite:4},h.KiiACLEntry=function(){function e(){this.getEntityString=p(this.getEntityString,this),this.getActionString=p(this.getActionString,this),this.getGrant=p(this.getGrant,this),this.setGrant=p(this.setGrant,this),this.getSubject=p(this.getSubject,this),this.setSubject=p(this.setSubject,this),this.getAction=p(this.getAction,this),this.setAction=p(this.setAction,this),this._action=-1,this._grant=!0}return e.prototype.setAction=function(e){if(e>=h.KiiACLAction.KiiACLBucketActionCreateObjects&&e<=h.KiiACLAction.KiiACLObjectActionWrite)return this._action=e;throw new h.InvalidACLAction},e.prototype.getAction=function(){return this._action},e.prototype.setSubject=function(e){if(e instanceof h.KiiGroup&&null!=e.getID()||e instanceof h.KiiUser&&null!=e.getID()||e instanceof h.KiiAnyAuthenticatedUser||e instanceof h.KiiAnonymousUser)return this._subject=e;throw new h.InvalidACLSubject},e.prototype.getSubject=function(){return this._subject},e.prototype.setGrant=function(e){if(e===!0||e===!1)return this._grant=e;throw new h.InvalidACLGrant},e.prototype.getGrant=function(){return this._grant},e.entryWithSubject=function(e,t){var i;return h.Kii.logger("EWS: "+e+", "+t),i=new h.KiiACLEntry,i.setSubject(e),i.setAction(t),i},e.prototype.getActionString=function(){var e;switch(h.Kii.logger("Action: "+this.action),this._action){case h.KiiACLAction.KiiACLBucketActionCreateObjects:e="CREATE_OBJECTS_IN_BUCKET";break;case h.KiiACLAction.KiiACLBucketActionQueryObjects:e="QUERY_OBJECTS_IN_BUCKET";break;case h.KiiACLAction.KiiACLBucketActionDropBucket:e="DROP_BUCKET_WITH_ALL_CONTENT";break;case h.KiiACLAction.KiiACLObjectActionRead:e="READ_EXISTING_OBJECT";break;case h.KiiACLAction.KiiACLObjectActionWrite:e="WRITE_EXISTING_OBJECT";break;default:return e}return e},e.prototype.getEntityString=function(){var e,t;return this._subject instanceof h.KiiGroup?(e=this._subject.getUUID(),t="GroupID"):this._subject instanceof h.KiiUser?(e=this._subject.getUUID(),t="UserID"):this._subject instanceof h.KiiAnyAuthenticatedUser?(t="UserID",e="ANY_AUTHENTICATED_USER"):this._subject instanceof h.KiiAnonymousUser&&(t="UserID",e="ANONYMOUS_USER"),""+t+":"+e},e}(),h.KiiBucket=function(){function e(e,t){this.objectWithJSON=p(this.objectWithJSON,this),this._generatePath=p(this._generatePath,this),this._getRequest=p(this._getRequest,this),this["delete"]=p(this["delete"],this),this.count=p(this.count,this),this.countWithQuery=p(this.countWithQuery,this),this.executeQuery=p(this.executeQuery,this),this.acl=p(this.acl,this),this.createObjectWithID=p(this.createObjectWithID,this),this.createObjectWithType=p(this.createObjectWithType,this),this.createObject=p(this.createObject,this),this._getQualifiedBucketName=p(this._getQualifiedBucketName,this),this._setBucketName=p(this._setBucketName,this),this.getBucketName=p(this.getBucketName,this),this._setGroup=p(this._setGroup,this),this.getGroup=p(this.getGroup,this),this._setUser=p(this._setUser,this),this.getUser=p(this.getUser,this),this._bucketName=e,null!=t&&(t instanceof h.KiiGroup?this._group=t:t instanceof h.KiiUser&&(this._user=t))}return e.prototype._className="KiiBucket",e.prototype.getUser=function(){return this._user},e.prototype._setUser=function(e){this._user=e},e.prototype.getGroup=function(){return this._group},e.prototype._setGroup=function(e){this._group=e},e.prototype.getBucketName=function(){return this._bucketName},e.prototype._setBucketName=function(e){this._bucketName=e},e.prototype._getQualifiedBucketName=function(){return this._bucketName},e.prototype.createObject=function(){return h.KiiObject.objectWithBucket(this,null)},e.prototype.createObjectWithType=function(e){return h.KiiObject.objectWithBucket(this,e)},e.prototype.createObjectWithID=function(e){if(!h.KiiObject.isValidObjectID(e))throw h.InvalidArgumentException("Specified obejctID is invalid.");return h.KiiObject.objectWithID(this,e)},e.prototype.acl=function(){return h.KiiACL.aclWithParent(this)},e.prototype.executeQuery=function(e,t){var i,n,r,s;return r=this._generatePath()+"/query",i={},null!=e?i=e._dictValue():i.bucketQuery={clause:h.KiiQuery._emptyDictValue()},s=this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.QueryRequest+json"),s.setData(i),n={success:function(i){return function(n,r){var s,o,u,a,l,c;if(300>r&&r>=200){for(u=[],c=n.results,a=0,l=c.length;l>a;a++)o=c[a],u.push(i.objectWithJSON(o));if(null!=n.nextPaginationKey?(s=new h.KiiQuery(e),s.setPaginationKey(n.nextPaginationKey)):s=null,null!=t)return t.success(e,u,s)}else if(null!=t)return t.failure(e,"Unable to parse response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},s.execute(n,!1)},e.prototype.countWithQuery=function(e,t){var i,n,r,s;return r=this._generatePath()+"/query",i={},null!=e?i=e._dictValue():(i.bucketQuery={clause:h.KiiQuery._emptyDictValue()},e=h.KiiQuery.queryWithClause()),i.bucketQuery.aggregations=[{type:"COUNT",putAggregationInto:"count_field"}],s=this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.QueryRequest+json"),s.setData(i),n={success:function(i){return function(n,r){var s;if(300>r&&r>=200){if(s=n.aggregations.count_field,null!=t)return t.success(i,e,s)}else if(null!=t)return t.failure(i,e,"Unable to parse response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},s.execute(n,!1)},e.prototype.count=function(e){var t;return t=h.KiiQuery.queryWithClause(),this.countWithQuery(t,e)},e.prototype["delete"]=function(e){var t,i;return i=this._getRequest({path:this._generatePath(),withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(){return null!=e?e.success(t):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e._bucketWithName=function(e,t){var i;return i=new h.KiiBucket(e,t)},e.prototype._getRequest=function(e){var t,n,r;return t=e.path,r=e.withApp,n=new i(t,r)},e.prototype._generatePath=function(){var e;return e=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._getQualifiedBucketName():null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._getQualifiedBucketName():"/buckets/"+this._getQualifiedBucketName()},e.prototype.objectWithJSON=function(e){var t;return t=this.createObject(),t._updateWithJSON(e),t},e}(),h.KiiEncryptedBucket=function(e){function t(e,i){this._getQualifiedBucketName=p(this._getQualifiedBucketName,this),h.KiiEncryptedBucket._isEncrypted(e)?t.__super__.constructor.call(this,e.replace("CRYPTO:",""),i):t.__super__.constructor.call(this,e,i)}return _(t,e),t.prototype._getQualifiedBucketName=function(){return"CRYPTO:"+this._bucketName},t._bucketWithName=function(e,t){var i;return i=new h.KiiEncryptedBucket(e,t)},t._isEncrypted=function(e){var t;return t=0===e.indexOf("CRYPTO:")},t}(h.KiiBucket),h.KiiEncryptedBucketAdmin=function(e){function t(e,i,n){this.acl=p(this.acl,this),this.createObjectWithID=p(this.createObjectWithID,this),this.createObjectWithType=p(this.createObjectWithType,this),this.createObject=p(this.createObject,this),this._getRequest=p(this._getRequest,this),t.__super__.constructor.call(this,e,i),this._adminToken=n}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype.createObject=function(){return h.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},t.prototype.createObjectWithType=function(e){return h.KiiObjectAdmin.objectWithBucket(this,e,this._adminToken)},t.prototype.createObjectWithID=function(e){return h.KiiObjectAdmin.objectWithID(this,e,this._adminToken)},t.prototype.acl=function(){var e;return e=new h.KiiACLAdmin(this,this._adminToken)},t}(h.KiiEncryptedBucket),h.KiiBucketAdmin=function(e){function t(e,i,n){this.acl=p(this.acl,this),this.createObjectWithID=p(this.createObjectWithID,this),this.createObjectWithType=p(this.createObjectWithType,this),this.createObject=p(this.createObject,this),this._getRequest=p(this._getRequest,this),t.__super__.constructor.call(this,e,i),this._adminToken=n}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype.createObject=function(){return h.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},t.prototype.createObjectWithType=function(e){return h.KiiObjectAdmin.objectWithBucket(this,e,this._adminToken)},t.prototype.createObjectWithID=function(e){return h.KiiObjectAdmin.objectWithID(this,e,this._adminToken)},t.prototype.acl=function(){var e;return e=new h.KiiACLAdmin(this,this._adminToken)},t}(h.KiiBucket),h.KiiGroup=function(){function e(){this._setOwnerFromContext=p(this._setOwnerFromContext,this),this._userWithID=p(this._userWithID,this),this._getRequest=p(this._getRequest,this),this._updateWithJSON=p(this._updateWithJSON,this),this.getOwner=p(this.getOwner,this),this["delete"]=p(this["delete"],this),this.refresh=p(this.refresh,this),this.save=p(this.save,this),this.changeGroupName=p(this.changeGroupName,this),this._saveMembers=p(this._saveMembers,this),this.getMemberList=p(this.getMemberList,this),this._removeMember=p(this._removeMember,this),this._addMember=p(this._addMember,this),this.removeUser=p(this.removeUser,this),this.addUser=p(this.addUser,this),this.encryptedBucketWithName=p(this.encryptedBucketWithName,this),this.bucketWithName=p(this.bucketWithName,this),this.objectURI=p(this.objectURI,this),this._setOwner=p(this._setOwner,this),this.getCachedOwner=p(this.getCachedOwner,this),this._setName=p(this._setName,this),this.getName=p(this.getName,this),this.getID=p(this.getID,this),this._setUUID=p(this._setUUID,this),this.getUUID=p(this.getUUID,this),this._setAddMembers=p(this._setAddMembers,this),this._getRemoveMembers=p(this._getRemoveMembers,this),this._getAddMembers=p(this._getAddMembers,this),this._addMembers={},this._removeMembers={}}return e.prototype._getAddMembers=function(){return this._addMembers},e.prototype._getRemoveMembers=function(){return this._removeMembers},e.prototype._setAddMembers=function(e){var t,i,n,r;if(null!=e){for(r=[],i=0,n=e.length;n>i;i++)t=e[i],r.push(this.addUser(t));return r}},e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getID=function(){return this._uuid},e.prototype.getName=function(){return this._groupName},e.prototype._setName=function(e){this._groupName=e},e.prototype.getCachedOwner=function(){return this._owner},e.prototype._setOwner=function(e){this._owner=e},e.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},e.prototype.bucketWithName=function(e){var t;return t=new h.KiiBucket(e,this)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new h.KiiEncryptedBucket(e,this)},e.prototype.addUser=function(e){var t;return null==e?void h.Kii.logger("Passed member is null"):null==e.getUUID()?void h.Kii.logger("Passed member ID is null"):(t=e.getUUID(),t in this._addMembers||(this._addMembers[t]=e),t in this._removeMembers?delete this._removeMembers[t]:void 0)},e.prototype.removeUser=function(e){var t;return null==e?void h.Kii.logger("Passed member is null"):null==e.getUUID()?void h.Kii.logger("Passed member uuid is null"):(t=e.getUUID(),t in this._removeMembers||(this._removeMembers[t]=e),t in this._addMembers?delete this._addMembers[t]:void 0)},e.prototype._addMember=function(e,t){var i,n;return h.Kii.logger("Adding member "+e.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+e.getUUID(),withApp:!0}),n.setMethod("PUT"),i={success:function(i){return function(){return delete i._addMembers[e.getUUID()],i._saveMembers(t)}}(this),failure:function(i){return function(n){var r,s,o;return r=function(){var t,i;t=this._addMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),s=function(){var t,i;t=this._removeMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),t.failure(i,n,r,s)}}(this)},n.execute(i,!1)},e.prototype._removeMember=function(e,t){var i,n;return h.Kii.logger("Removing member "+e.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+e.getUUID(),withApp:!0}),n.setMethod("DELETE"),i={success:function(i){return function(){return delete i._getRemoveMembers()[e.getUUID()],i._saveMembers(t)}}(this),failure:function(i){return function(n){var r,s,o;return r=function(){var t,i;t=this._addMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),s=function(){var t,i;t=this._removeMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),t.failure(i,n,r,s)}}(this)},n.execute(i,!1)},e.prototype.getMemberList=function(e){var t,i;return h.Kii.logger("Getting member list for group "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid+"/members",withApp:!0}),i.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],o=i.members,u=0,a=o.length;a>u;u++)r=o[u],s.push(t._userWithID(r.userID));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,r,"Unable to get member list of group")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype._saveMembers=function(e){var t,i;return t=Object.keys(this._addMembers),i=Object.keys(this._removeMembers),0===t.length&&0===i.length&&e.success(this),t.length>0?void this._addMember(this._addMembers[t[0]],e):void(i.length>0&&this._removeMember(this._removeMembers[i[0]],e))},e.prototype.changeGroupName=function(e,t){var i,n;return h.Kii.logger("Saving group: "+this.name),null!=this._uuid?(i=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),i.setContentType("text/plain"),i.setMethod("PUT"),i.setData(e),n={success:function(i){return function(n,r){if(300>r&&r>=200){if(i._setName(e),null!=t)return t.success(i)}else if(null!=t)return t.failure(i,"Unable to change group name - invalid response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(n,!0)):t.failure(this,"Invalid group. Save the group on the server before updating the name.")},e.prototype.save=function(e){var t,i,n;return h.Kii.logger("Saving group: "+this.name),null==this._uuid?(i=this._getRequest({path:"/groups",withApp:!0}),i.setContentType("application/vnd.kii.GroupCreationRequest+json"),i.setMethod("POST"),t={},null!=this._groupName&&(t.name=this._groupName),this._setOwnerFromContext(t),i.setData(t),n={success:function(t){return function(i,n){return 300>n&&n>=200?(t._setUUID(i.groupID),t._saveMembers(e)):void 0}}(this),failure:function(t){return function(i){var n,r,s,o;return null!=e?(n=function(){var e,t;e=this._addMembers,t=[];for(o in e)r=e[o],t.push(r);return t}.call(t),s=function(){var e,t;e=this._removeMembers,t=[];for(o in e)r=e[o],t.push(r);return t}.call(t),e.failure(t,i,n,s)):void 0}}(this)},i.execute(n,!1)):this._saveMembers(e)},e.prototype.refresh=function(e){var t,i;return h.Kii.logger("Refreshing group: "+this._groupName),i=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),t={success:function(t){return function(i){return t._updateWithJSON(i),null!=e?e.success(t):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype["delete"]=function(e){var t,i;return h.Kii.logger("Deleting group: "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e.prototype.getOwner=function(e){return h.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(){return function(t){return null!=e?e.success(t,t.getCachedOwner()):void 0}}(this),failure:function(){return function(t,i){return null!=e?e.failure(t,i):void 0}}(this)})},e.groupWithName=function(e){return h.KiiGroup.groupWithNameAndMembers(e,null)},e.groupWithNameAndMembers=function(e,t){var i;return i=new h.KiiGroup,i._setName(e),i._setAddMembers(t),i},e.groupWithID=function(e){var t;if(null==e||""===e)throw new h.InvalidArgumentException("groupID should not null or empty");return t=new h.KiiGroup,t._setUUID(e),t},e.groupWithURI=function(e){var t,i,n,r;if(n=null,r=e.substr("kiicloud://".length),i=r.split("/"),t=i.length,!(t>0))throw new h.InvalidURIException;return n=new h.KiiGroup,n._setUUID(i[t-1]),n},e._groupWithJSON=function(e){var t;return t=new h.KiiGroup,null!=e.groupID&&t._setUUID(e.groupID),null!=e.name&&t._setName(e.name),null!=e.owner&&t._setOwner(h.KiiUser.userWithID(e.owner)),t},e.prototype._updateWithJSON=function(e){return null!=e.groupID&&this._setUUID(e.groupID),this._setName(null!=e.name?e.name:null),this._setOwner(null!=e.owner?this._userWithID(e.owner):null)},e.prototype._getRequest=function(e){var t,n,r;return t=e.path,r=e.withApp,n=new i(t,r)},e.prototype._userWithID=function(e){var t;return t=h.KiiUser.userWithID(e)},e.prototype._setOwnerFromContext=function(e){return null!=h.Kii.getCurrentUser()?(this._owner=h.Kii.getCurrentUser(),e.owner=this._owner.getUUID()):void 0},e}(),h.KiiObject=function(){function e(){this.deleteBody=p(this.deleteBody,this),this.publishBodyExpiresIn=p(this.publishBodyExpiresIn,this),this.publishBodyExpiresAt=p(this.publishBodyExpiresAt,this),this.publishBody=p(this.publishBody,this),this.downloadBody=p(this.downloadBody,this),this.uploadBody=p(this.uploadBody,this),this.moveBody=p(this.moveBody,this),this._parseObjectUri=p(this._parseObjectUri,this),this._userWithID=p(this._userWithID,this),this._setAuthorizationHeader=p(this._setAuthorizationHeader,this),this._getToken=p(this._getToken,this),this._getRequest=p(this._getRequest,this),this._setETag=p(this._setETag,this),this["delete"]=p(this["delete"],this),this.refresh=p(this.refresh,this),this.save=p(this.save,this),this.saveAllFields=p(this.saveAllFields,this),this._performUpdate=p(this._performUpdate,this),this._performSave=p(this._performSave,this),this._updateWithJSON=p(this._updateWithJSON,this),this.objectURI=p(this.objectURI,this),this.objectACL=p(this.objectACL,this),this.getGeoPoint=p(this.getGeoPoint,this),this.setGeoPoint=p(this.setGeoPoint,this),this.get=p(this.get,this),this.set=p(this.set,this),this._getPath=p(this._getPath,this),this._setBodyContentType=p(this._setBodyContentType,this),this.getBodyContentType=p(this.getBodyContentType,this),this._setBucket=p(this._setBucket,this),this.getBucket=p(this.getBucket,this),this._setObjectType=p(this._setObjectType,this),this.getObjectType=p(this.getObjectType,this),this._setModified=p(this._setModified,this),this.getModified=p(this.getModified,this),this._setCreated=p(this._setCreated,this),this.getCreated=p(this.getCreated,this),this._setUUID=p(this._setUUID,this),this.getUUID=p(this.getUUID,this),this._customInfo={},this._alteredFields=[]}return e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getCreated=function(){return this._created},e.prototype._setCreated=function(e){this._created=e},e.prototype.getModified=function(){return this._modified},e.prototype._setModified=function(e){this._modified=e},e.prototype.getObjectType=function(){return this._objectType},e.prototype._setObjectType=function(e){this._objectType=e},e.prototype.getBucket=function(){return h.Kii.logger("GEtting bucket "+this._bucket),this._bucket},e.prototype._setBucket=function(e){this._bucket=e},e.prototype.getBodyContentType=function(){return this._bodyContentType},e.prototype._setBodyContentType=function(e){this._bodyContentType=e},e.prototype._getPath=function(){var e;return e=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/",null!=this._uuid&&(e+=this._uuid),e},e.prototype.set=function(e,t){return this._customInfo[e]=t,this._alteredFields.push(e)},e.prototype.get=function(e){return this._customInfo[e]},e.prototype.setGeoPoint=function(e,t){if(!(t instanceof h.KiiGeoPoint))throw h.InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[e]=t._toDict(),this._alteredFields.push(e)},e.prototype.getGeoPoint=function(e){var t,i,n;return n=this._customInfo[e],t=n.lat,i=n.lon,h.KiiGeoPoint.geoPoint(t,i)},e.prototype.objectACL=function(){return h.KiiACL.aclWithParent(this)},e.prototype.objectURI=function(){var e,t;return e="kiicloud://",null!=this._bucket&&null!=this._uuid&&(t=e,null!=this._bucket.getGroup()?t+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()&&(t+="users/"+this._bucket.getUser().getUUID()+"/"),t+="buckets/"+this._bucket._getQualifiedBucketName()+"/objects/"+this._uuid),t},e.prototype._updateWithJSON=function(e){var t,i,n;n=[];for(t in e)i=e[t],"objectID"===t||"_id"===t||"uuid"===t?(h.Kii.logger("Setting uuid: "+i),n.push(this._uuid=i)):n.push("createdAt"===t||"_created"===t||"created"===t?this._created=i:"modifiedAt"===t||"_modified"===t||"modified"===t?this._modified=i:"_owner"===t?this._owner=this._userWithID(i):"_dataType"===t?this._objectType=i:"_calculated"===t?this._customInfo[t]=i:"_"!==t[0]?this._customInfo[t]=i:"_version"===t?this._etag=i:void 0);return n},e.prototype._performSave=function(e){var t,i,n,r;return i=this._getPath(),n=new this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),t=this._customInfo,n.setData(t),null!=this._objectType&&n.setContentType("application/vnd."+h.Kii.getAppID()+"."+this._objectType+"+json"),r={success:function(t){return function(i,n,r){if(300>n&&n>=200){if(t._etag=r.ETag,t._updateWithJSON(i),t._alteredFields=[],null!=e)return e.success(t)
}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!1)},e.prototype._performUpdate=function(e,t,i){var n,r,s,o,u,a,l,c,p;if(o=this._getPath(),u=new this._getRequest({path:o,withApp:!0}),n={},e)for(u.addHeader("X-HTTP-Method-Override","PATCH"),u.setMethod("POST"),p=this._alteredFields,l=0,c=p.length;c>l;l++)s=p[l],n[s]=this._customInfo[s];else u.setMethod("PUT"),n=this._customInfo;if(u.setData(n),r=this._created>0,!i)if(r){if(null==this._etag)return void t.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");u.addHeader("If-Match",this._etag)}else{if(e&&null==this._etag)return void t.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");u.addHeader("If-None-Match","*")}return null!=this._objectType&&u.setContentType("application/vnd."+h.Kii.getAppID()+"."+this._objectType+"+json"),a={success:function(e){return function(i,n,r){if(300>n&&n>=200){if(e._etag=r.ETag,e._updateWithJSON(i),e._alteredFields=[],null!=t)return t.success(e)}else if(null!=t)return t.failure(e,"Unable to parse response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},u.execute(a,!1)},e.prototype.saveAllFields=function(e,t){return null==t&&(t=!0),null!=this._uuid?this._performUpdate(!1,e,t):this._performSave(e)},e.prototype.save=function(e,t){return null==t&&(t=!0),null!=this._uuid?this._performUpdate(!0,e,t):this._performSave(e)},e.prototype.refresh=function(e){var t,i,n;return t=this._getPath(),n=new this._getRequest({path:t,withApp:!0}),i={success:function(t){return function(i,n,r){if(300>n&&n>=200){if(t._etag=r.ETag,t._updateWithJSON(i),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(i,!1)},e.prototype["delete"]=function(e){var t,i,n;return t=this._getPath(),n=new this._getRequest({path:t,withApp:!0}),n.setMethod("DELETE"),i={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(i,!0)},e.objectWithBucket=function(e,t){var i;return h.Kii.logger("Creating object w type: "+t),i=new h.KiiObject,i._setBucket(e),i._setObjectType(t),h.Kii.logger(i),i},e.objectWithID=function(e,t){var i;return h.Kii.logger("Creating object with id: "+t),i=new h.KiiObject,i._setBucket(e),i._setUUID(t),h.Kii.logger(i),i},e.prototype._setETag=function(e){this._etag=e},e.objectWithURI=function(e){var t,i,n,r,s,o,u,a,l,c;if(u=e.substr("kiicloud://".length),s=u.split("/"),r=s.length,h.Kii.logger(s),!(r>=4))throw new h.InvalidURIException;return i=4===r?1:3,n=s[i],"groups"===s[0]?o=new h.KiiGroup.groupWithID(s[1]):"users"===s[0]&&(c=h.KiiUser.userWithID(s[1])),l=null,null!=o?l=o:null!=c&&(l=c),t=null,t=h.KiiEncryptedBucket._isEncrypted(n)?new h.KiiEncryptedBucket._bucketWithName(n,l):new h.KiiBucket._bucketWithName(n,l),h.Kii.logger(t),a=t.createObject(),a._setUUID(s[r-1]),h.Kii.logger(a),a},e.prototype._getRequest=function(e){var t,n,r;return t=e.path,r=e.withApp,n=new i(t,r)},e.prototype._getToken=function(){var e,t;return e=h.KiiUser.getCurrentUser(),t=e?e.getAccessToken():null,t?t:null},e.prototype._setAuthorizationHeader=function(e){var t;return t=this._getToken(),t?e.setRequestHeader("Authorization","Bearer "+t):void 0},e.prototype._userWithID=function(e){var t;return t=h.KiiUser.userWithID(e)},e.prototype._parseObjectUri=function(e){var t,i,n,r;return n=e.replace(/^kiicloud:\/\//g,"").split("/"),r=n[0],"users"===r?(i={appID:h.Kii.getAppID(),userID:n[1],type:"APP_AND_USER"},t={targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]}):"groups"===r?(i={appID:h.Kii.getAppID(),groupID:n[1],type:"APP_AND_GROUP"},t={targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]}):(i={appID:h.Kii.getAppID(),type:"APP"},t={targetObjectScope:i,targetBucketID:n[1],targetObjectID:n[3]}),t},e.prototype.moveBody=function(e,t){var i,n,r;if(null==e)throw h.InvalidArgumentException("targetObjectUri is required");if(null==this.getUUID())throw h.InvalidArgumentException("Source object is not saved on the cloud");return n=this._getPath()+"/body/move",r=new this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),r.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json"),r.setData(this._parseObjectUri(e)),i={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?t.success(i,e):null!=t?t.failure(i,e,"Unable to parse response"):void 0}}(this),failure:function(i){return function(n){return null!=t?t.failure(i,e,n):void 0}}(this)},r.execute(i,!0)},e.prototype.uploadBody=function(e,t){var i,n,r,s,o;return e&&e instanceof Blob?(r=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+this._getPath()+"/body",i="application/octet-stream",e.type&&(i=e.type),s=u.createXHRWrapper("PUT",r),o=s.xhr,o.setRequestHeader("Content-Type",i),o.setRequestHeader("x-kii-appid",h.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(o),n={success:function(e){return function(){return e._setBodyContentType(i),null!=t?t.success(e):void 0}}(this),failure:function(e){return function(){var i,n;if(i="failed to upload body. statusCode: "+o.status,null!=t)try{if(n=JSON.parse(decodeURIComponent(o.responseText)),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" message: "+n.message}catch(r){}finally{h.Kii.logger("Failure: "+i),h.Kii.logger(o.responseText),t.failure(e,i)}}}(this),progress:function(){return function(e){return t&&t.progress?t.progress(e):void 0}}(this)},s.sendData(e,n)):void t.failure(this,"Invalid parameter")},e.prototype.downloadBody=function(e){var t,i,n,r;return i=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+this._getPath()+"/body",n=u.createXHRWrapper("GET",i),r=n.xhr,r.setRequestHeader("x-kii-appid",h.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),r.responseType="blob",t={success:function(t){return function(){var i;return i=r.status,t._setBodyContentType(r.getResponseHeader("content-type")),null!=e?e.success(t,r.response):void 0}}(this),failure:function(){return function(){var t,i,n;return null!=e?(t="failed to download body. statusCode: "+r.status,i=new FileReader,n=null,i.onload=function(){var i;n=this.result;try{if(i=JSON.parse(decodeURIComponent(n)),null!=i.errorCode&&(t+=" error code: "+i.errorCode),null!=i.message)return t+=" message: "+i.message}catch(s){}finally{h.Kii.logger("Failure: "+t),h.Kii.logger(r.response),e.failure(this,t)}},i.readAsText(r.response)):void 0}}(this),progress:function(){return function(t){return e&&e.progress?e.progress(t):void 0}}(this)},n.send(t)},e.prototype.publishBody=function(e){var t,i,n,r,s,o;return r=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+this._getPath()+"/body/publish",s=u.createXHRWrapper("POST",r),o=s.xhr,o.setRequestHeader("x-kii-appid",h.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),o.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(o),n={success:function(t){return function(){var i;if(null!=e)try{return i=JSON.parse(o.responseText),i.url?e.success(t,i.url):e.failure(t,"failed to parse response")}catch(n){return e.failure(t,"failed to parse response")}}}(this),failure:function(t){return function(){var i,n;if(null!=e){i="failed to publish body. statusCode: "+o.status;try{if(n=JSON.parse(o.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{e.failure(t,i)}}}}(this)},i={},t=JSON.stringify(i),s.sendData(t,n)},e.prototype.publishBodyExpiresAt=function(e,t){var i,n,r,s,o,a;return s=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+this._getPath()+"/body/publish",o=u.createXHRWrapper("POST",s),a=o.xhr,a.setRequestHeader("x-kii-appid",h.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(a),r={success:function(e){return function(){var i;if(null!=t)try{return i=JSON.parse(a.responseText),i.url?t.success(e,i.url):t.failure(e,"failed to parse response")}catch(n){return t.failure(e,"failed to parse response")}}}(this),failure:function(e){return function(){var i,n;if(null!=t){i="failed to publish body. statusCode: "+a.status,null==a.responseText&&t.failure(e,i);try{if(n=JSON.parse(a.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{t.failure(e,i)}}}}(this)},n={},n.expiresAt=e,i=JSON.stringify(n),o.sendData(i,r)},e.prototype.publishBodyExpiresIn=function(e,t){var i,n,r,s,o,a;return s=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+this._getPath()+"/body/publish",o=u.createXHRWrapper("POST",s),a=o.xhr,a.setRequestHeader("x-kii-appid",h.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(a),r={success:function(e){return function(){var i;try{return i=JSON.parse(a.responseText),i.url?t.success(e,i.url):t.failure(e,"failed to parse response")}catch(n){return t.failure(e,"failed to parse response")}}}(this),failure:function(e){return function(){var i,n;i="failed to publish body. statusCode: "+a.status;try{if(n=JSON.parse(a.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{t.failure(e,i)}}}(this)},n={},n.expiresIn=e,i=JSON.stringify(n),o.sendData(i,r)},e.prototype.deleteBody=function(e){var t,i,n,r;return i=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+this._getPath()+"/body",n=u.createXHRWrapper("DELETE",i),r=n.xhr,r.setRequestHeader("x-kii-appid",h.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),t={success:function(t){return function(){return t._setBodyContentType(null),null!=e?e.success(t):void 0}}(this),failure:function(t){return function(){var i,n;if(null!=e){i="failed to delete body. statusCode: "+r.status;try{if(n=JSON.parse(r.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(s){}finally{e.failure(t,i)}}}}(this)},n.send(t)},e.isValidObjectID=function(e){var t;return t=/^[a-zA-Z0-9-_.]{2,100}$/i,"string"!==(typeof e).toLowerCase()?!1:null!==e.match(t)?!0:!1},e}(),h.KiiQuery=function(){function e(e){return this._dictValue=p(this._dictValue,this),this.sortByAsc=p(this.sortByAsc,this),this.sortByDesc=p(this.sortByDesc,this),this.setLimit=p(this.setLimit,this),this.getLimit=p(this.getLimit,this),this._setClause=p(this._setClause,this),this.setPaginationKey=p(this.setPaginationKey,this),this.getPaginationKey=p(this.getPaginationKey,this),this._clone=p(this._clone,this),this._clone(e)}return e.prototype._clone=function(e){var t,i;if(null==e||"object"!=typeof e)return e;i=new e.constructor;for(t in e)i[t]=this._clone(e[t]);return i},e.prototype.getPaginationKey=function(){return this._paginationKey},e.prototype.setPaginationKey=function(e){this._paginationKey=e},e.prototype._setClause=function(e){this._clause=e},e.prototype.getLimit=function(){return this._limit},e.prototype.setLimit=function(e){if(e>0)return this._limit=e;throw new h.InvalidLimitException},e.queryWithClause=function(e){var t;return t=new h.KiiQuery,t._setClause(e),t},e.prototype.sortByDesc=function(e){return this._sortField=e,this._sortDescending=!0},e.prototype.sortByAsc=function(e){return this._sortField=e,this._sortDescending=!1},e._emptyDictValue=function(){return{type:"all"}},e.prototype._dictValue=function(){var e,t;return t={},t.bestEffortLimit=this._limit,null!=this._paginationKey&&(t.paginationKey=this._paginationKey),e={descending:this._sortDescending},e.clause=null!=this._clause?this._clause._getDictValue():h.KiiQuery._emptyDictValue(),null!=this._sortField&&(e.orderBy=this._sortField),t.bucketQuery=e,t},e}(),h.KiiClause=function(){function e(){this._getDictValue=p(this._getDictValue,this),this._setDictValue=p(this._setDictValue,this),this._setWhereClauses=p(this._setWhereClauses,this),this._setWhereType=p(this._setWhereType,this)}return e.constructor=function(){return e._whereClauses=[],e._dictExpression={}},e.prototype._setWhereType=function(e){this._whereType=e},e.prototype._setWhereClauses=function(e){this._whereClauses=e},e.prototype._setDictValue=function(e){this._dictExpression=e},e.prototype._getDictValue=function(){var e,t,i,n,r,s;if(i={},null!=this._whereClauses&&null!=this._whereType)if(t=[],1===this._whereClauses.length)e=this._whereClauses[0],i="not"===this._whereType?{type:this._whereType,clause:e._getDictValue()}:e._getDictValue();else{for(s=this._whereClauses,n=0,r=s.length;r>n;n++)e=s[n],t.push(e._getDictValue());i={type:this._whereType,clauses:t}}else null!=this._whereClauses?this._whereClauses.length>0&&(i=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(i=this._dictExpression);return null==i&&(i=h.KiiQuery.emptyDictValue()),i},e.createWithWhere=function(e,t){var i;return i=new h.KiiClause,i._setWhereType(e),i._setWhereClauses(t),i},e.create=function(e,t,i){var n,r;return n=new h.KiiClause,r={},"="===e?(r.type="eq",r.field=t,r.value=i):"<"===e?(r.type="range",r.field=t,r.upperLimit=i,r.upperIncluded=!1):"<="===e?(r.type="range",r.field=t,r.upperLimit=i,r.upperIncluded=!0):">"===e?(r.type="range",r.field=t,r.lowerLimit=i,r.lowerIncluded=!1):">="===e?(r.type="range",r.field=t,r.lowerLimit=i,r.lowerIncluded=!0):"in"===e?(r.type="in",r.field=t,r.values=i):"prefix"===e&&(r.type="prefix",r.field=t,r.prefix=i),n._setDictValue(r),n},e.and=function(){return e.createWithWhere("and",arguments)},e.or=function(){return e.createWithWhere("or",arguments)},e.equals=function(e,t){return null!=t._className&&(t=t.objectURI),h.KiiClause.create("=",e,t)},e.notEquals=function(e,t){return null!=t._className&&(t=t.objectURI),h.KiiClause.createWithWhere("not",[h.KiiClause.equals(e,t)])},e.greaterThan=function(e,t){return h.KiiClause.create(">",e,t)},e.greaterThanOrEqual=function(e,t){return h.KiiClause.create(">=",e,t)},e.lessThan=function(e,t){return h.KiiClause.create("<",e,t)},e.lessThanOrEqual=function(e,t){return h.KiiClause.create("<=",e,t)},e["in"]=function(e,t){return h.KiiClause.create("in",e,t)},e.inClause=function(e,t){return h.KiiClause.create("in",e,t)},e.startsWith=function(e,t){return h.KiiClause.create("prefix",e,t)},e.geoDistance=function(e,t,i,n){var r,s,o,u,a;if(o=function(e){return"string"==typeof e&&e.length>0},s=function(e){return null==e?!1:e instanceof h.KiiGeoPoint},!o(e))throw h.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!s(t))throw h.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(u="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=n&&!n.match(u))throw h.InvalidArgumentException("putDistanceInto is invalid.");if(0>=i||i>2e7||isNaN(i))throw h.InvalidArgumentException("radius is invalid.");return r=new h.KiiClause,a={},a.type="geodistance",a.field=e,t=t._toDict(),a.center=t,a.radius=i,a.putDistanceInto=n,r._setDictValue(a),r},e.geoBox=function(e,t,i){var n,r,s,o,u,a;if(s=function(e){return"string"==typeof e&&e.length>0},r=function(e){return null==e?!1:e instanceof h.KiiGeoPoint},!s(e))throw h.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!r(t)||!r(i))throw h.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");return n=new h.KiiClause,a={},a.type="geobox",a.field=e,o=t._toDict(),u=i._toDict(),a.box={ne:o,sw:u},n._setDictValue(a),n},e}(),i=function(){function e(e,t){this.execute=p(this.execute,this),this.setAdminToken=p(this.setAdminToken,this),this.addHeader=p(this.addHeader,this),this.setAccept=p(this.setAccept,this),this.getAccept=p(this.getAccept,this),this.setAnonymous=p(this.setAnonymous,this),this.isAnonymous=p(this.isAnonymous,this),this.setContentType=p(this.setContentType,this),this.getContentType=p(this.getContentType,this),this.setData=p(this.setData,this),this.getData=p(this.getData,this),this.setHeaders=p(this.setHeaders,this),this.getHeaders=p(this.getHeaders,this),this.setMethod=p(this.setMethod,this),this.getMethod=p(this.getMethod,this),this.setPath=p(this.setPath,this),this.getPath=p(this.getPath,this),this._path=t?"/apps/"+h.Kii.getAppID()+e:e,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(){return function(){}}(this),this._failure=function(){return function(){}}(this),this._httpRequest=null}return e.prototype.getPath=function(){return this._path},e.prototype.setPath=function(e){this._path=e},e.prototype.getMethod=function(){return this._method},e.prototype.setMethod=function(e){this._method=e},e.prototype.getHeaders=function(){return this._headers},e.prototype.setHeaders=function(e){this._headers=e},e.prototype.getData=function(){return this._data},e.prototype.setData=function(e){this._data=e},e.prototype.getContentType=function(){return this._contentType},e.prototype.setContentType=function(e){this._contentType=e},e.prototype.isAnonymous=function(){return this._anonymous},e.prototype.setAnonymous=function(e){this._anonymous=e},e.prototype.getAccept=function(){return this._accept},e.prototype.setAccept=function(e){this._accept=e},e.prototype.addHeader=function(e,t){return this._headers[e]=t},e.prototype.setAdminToken=function(e){return this._adminToken=e},e.prototype.execute=function(e,t){var i,n,r,o,u,a,l;if(this._success=null!=e.success?e.success:this._success,this._failure=null!=e.failure?e.failure:this._failure,this._ignoreBody=t,u=h.Kii.getBaseURL()+this._path,h.Kii.logger("POSTING: "),h.Kii.logger(this._data),o=s._isJSONType(this._contentType)?JSON.stringify(this._data):this._data,h.Kii.logger("Making request["+this._method+"] to "+u+" with data: "+o),i=h.Kii.getAdditionalHeaders(),null!=i)for(r in i)a=i[r],this._headers[r]=a;this._headers["x-kii-appid"]=h.Kii.getAppID(),this._headers["x-kii-appkey"]=h.Kii.getAppKey(),this._headers["x-kii-sdk"]=h.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==h.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+h.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),null!=this._contentType&&(this._headers["Content-Type"]=this._contentType),h.Kii.logger("Headers: "),h.Kii.logger(this._headers),e={onComplete:function(e){return function(){var t,i,n,r,s,o,u;if(o=e._httpRequest.xhr,4===o.readyState){if(200<=(u=o.status)&&400>u){if(h.Kii.logger("Completed Request["+o.status+"]"),h.Kii.logger(o.responseText),s=e._parseResponseHeaders(o.getAllResponseHeaders()),e._ignoreBody)return e._success(null,o.status);try{r=JSON.parse(o.responseText)}catch(a){t=a,r=null}return null!=r?null!=r.errorCode?(i=r.errorCode,null!=r.message&&(i+=": "+r.message),e._failure(i,o.status,r.errorCode)):e._success(r,o.status,s):e._success(null,o.status,null)}h.Kii.logger("Error loading data..."),i=o.status+" : "+h.Kii.getBaseURL()+e._path;try{r=JSON.parse(decodeURIComponent(o.responseText))}catch(a){n=a,r=null}return null!=r&&null!=r.errorCode&&(i=r.errorCode,null!=r.message&&(i+=": "+r.message)),h.Kii.logger("Failure: "+i),h.Kii.logger(o.responseText),e._failure(i,o.status)}}}(this),onError:function(e){return function(){var t,i,n,r;r=e._httpRequest.xhr,h.Kii.logger("Error loading data..."),t=r.status+" : "+h.Kii.getBaseURL()+e._path;try{n=JSON.parse(decodeURIComponent(r.responseText))}catch(s){i=s,n=null}return null!=n&&null!=n.errorCode&&(t=n.errorCode,null!=n.message&&(t+=": "+n.message)),h.Kii.logger("Failure: "+t),h.Kii.logger(r.responseText),e._failure(t,r.status)}}(this)},this._httpRequest=this._createHttpRequest(this._method,u,e),null==this._httpRequest.xhr&&this._failure("Cross-Origin Resource Sharing is not supported by the browser.",0),l=this._headers;for(n in l)a=l[n],this._httpRequest.xhr.setRequestHeader(n,a);return"GET"!==this._method&&"DELETE"!==this._method?this._httpRequest.xhr.send(o):this._httpRequest.xhr.send()},e.prototype._createHttpRequest=function(e,i,n){var s;return s=null,null===h.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(h.Kii.logger("Use jQuery"),s=new t(e,i,n)):"undefined"!=typeof XMLHttpRequest?(h.Kii.logger("Use XMLHttpRequest"),s=new a(e,i,n)):"undefined"!=typeof Titanium&&(h.Kii.logger("Use Titanium"),s=new r(e,i,n)):(h.Kii.logger("Use http request backdoor"),h.Kii._getHttpRequestType()===h._KiiHttpRequestType.jQuery?(h.Kii.logger("Use jQuery"),s=new t(e,i,n)):h.Kii._getHttpRequestType()===h._KiiHttpRequestType.XMLHttpRequest?(h.Kii.logger("Use XMLHttpRequest"),s=new a(e,i,n)):h.Kii._getHttpRequestType()===h._KiiHttpRequestType.Titanium&&(h.Kii.logger("Use Titanium"),s=new r(e,i,n))),s},e.prototype._parseResponseHeaders=function(e){var t,i,n,r,s,o,u;if(n={},!e)return n;for(i=e.split("\r\n"),r=0;r<i.length;)t=i[r],s=t.indexOf(": "),s>0&&(o=t.substring(0,s),u=t.substring(s+2),n[o]=u),r++;return n},e}(),h.KiiUser=function(){function e(){this._groupWithJSON=p(this._groupWithJSON,this),this._setAuthHeader=p(this._setAuthHeader,this),this._getXhrWrapper=p(this._getXhrWrapper,this),this._getRequest=p(this._getRequest,this),this._updateWithJSON=p(this._updateWithJSON,this),this._validateLocalPhoneNumber=p(this._validateLocalPhoneNumber,this),this._validateIdentityData=p(this._validateIdentityData,this),this._updateWithUserFields=p(this._updateWithUserFields,this),this._updateWithIdentityData=p(this._updateWithIdentityData,this),this["delete"]=p(this["delete"],this),this.refresh=p(this.refresh,this),this.save=p(this.save,this),this.changeEmail=p(this.changeEmail,this),this.changePhone=p(this.changePhone,this),this.ownerOfGroups=p(this.ownerOfGroups,this),this.memberOfGroups=p(this.memberOfGroups,this),this.resendPhoneNumberVerification=p(this.resendPhoneNumberVerification,this),this.resendEmailVerification=p(this.resendEmailVerification,this),this.resendVerification=p(this.resendVerification,this),this.verifyPhoneNumber=p(this.verifyPhoneNumber,this),this.verifyCredentials=p(this.verifyCredentials,this),this.updatePassword=p(this.updatePassword,this),this.update=p(this.update,this),this.putIdentity=p(this.putIdentity,this),this.register=p(this.register,this),this._authenticateWithToken=p(this._authenticateWithToken,this),this._authenticate=p(this._authenticate,this),this.encryptedBucketWithName=p(this.encryptedBucketWithName,this),this.bucketWithName=p(this.bucketWithName,this),this.get=p(this.get,this),this.set=p(this.set,this),this.objectURI=p(this.objectURI,this),this.getAccessTokenObject=p(this.getAccessTokenObject,this),this._setExpiresAt=p(this._setExpiresAt,this),this._setAccessToken=p(this._setAccessToken,this),this.getAccessToken=p(this.getAccessToken,this),this.getLinkedSocialAccounts=p(this.getLinkedSocialAccounts,this),this._setPhoneVerified=p(this._setPhoneVerified,this),this.getPhoneVerified=p(this.getPhoneVerified,this),this._setEmailVerified=p(this._setEmailVerified,this),this.getEmailVerified=p(this.getEmailVerified,this),this._setModified=p(this._setModified,this),this.getModified=p(this.getModified,this),this._setCreated=p(this._setCreated,this),this.getCreated=p(this.getCreated,this),this.setCountry=p(this.setCountry,this),this.getCountry=p(this.getCountry,this),this._clearPassword=p(this._clearPassword,this),this._setPassword=p(this._setPassword,this),this._setPhoneNumber=p(this._setPhoneNumber,this),this.getPhoneNumber=p(this.getPhoneNumber,this),this._setEmailAddress=p(this._setEmailAddress,this),this.getEmailAddress=p(this.getEmailAddress,this),this.isPseudoUser=p(this.isPseudoUser,this),this.setDisplayName=p(this.setDisplayName,this),this.getDisplayName=p(this.getDisplayName,this),this._setDisabled=p(this._setDisabled,this),this.disabled=p(this.disabled,this),this._setUsername=p(this._setUsername,this),this.getUsername=p(this.getUsername,this),this.getID=p(this.getID,this),this._setUUID=p(this._setUUID,this),this.getUUID=p(this.getUUID,this),this._customInfo={}}return e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getID=function(){return this._uuid},e.prototype.getUsername=function(){return this._username},e.prototype._setUsername=function(e){var t;if(t=s._trim(e),h.Kii.logger("Setting username: "+t),s._validateUsername(t))return this._username=t;throw new h.InvalidUsernameException},e.prototype.disabled=function(){return this._disabled},e.prototype._setDisabled=function(e){this._disabled=e},e.prototype.getDisplayName=function(){return this._displayName},e.prototype.setDisplayName=function(e){if(!s._validateDisplayName(e))throw new h.InvalidDisplayNameException;return this._displayName=e},e.prototype.isPseudoUser=function(){return null!=this._hasPassword?!this._hasPassword:!this._username&&!this._emailAddress&&!this._phoneNumber},e.prototype.getEmailAddress=function(){return this._emailAddress},e.prototype._setEmailAddress=function(e){var t;if(t=s._trim(e),h.Kii.logger("Setting email: "+t),s._validateEmail(t))return this._emailAddress=t;throw new h.InvalidEmailException},e.prototype.getPhoneNumber=function(){return this._phoneNumber},e.prototype._setPhoneNumber=function(e){if(h.Kii.logger("Setting phone number: "+e),s._validatePhoneNumber(e))return this._phoneNumber=e;throw new h.InvalidPhoneNumberException},e.prototype._setPassword=function(e){if(s._validatePassword(e))return this._password=e;throw new h.InvalidPasswordException},e.prototype._clearPassword=function(){return this._password=null},e.prototype.getCountry=function(){return this._country},e.prototype.setCountry=function(e){if(s._validateCountryCode(e))return this._country=e;throw new h.InvalidCountryException},e.prototype.getCreated=function(){return this._created},e.prototype._setCreated=function(e){this._created=e},e.prototype.getModified=function(){return this._modified},e.prototype._setModified=function(e){this._modified=e},e.prototype.getEmailVerified=function(){return this._emailVerified},e.prototype._setEmailVerified=function(e){this._emailVerified=e},e.prototype.getPhoneVerified=function(){return this._phoneVerified},e.prototype._setPhoneVerified=function(e){this._phoneVerified=e},e.prototype.getLinkedSocialAccounts=function(){return h.Kii.logger("third party accounts: "+this._thirdPartyAccounts),null!=this._thirdPartyAccounts?this._thirdPartyAccounts:this._thirdPartyAccounts={}},e.prototype.getAccessToken=function(){return h.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},e.prototype._setAccessToken=function(e){return this._accessToken=e,h.Kii.logger("Setting access token: "+this._accessToken)},e.prototype._setExpiresAt=function(e){return this._expiresAt=e,h.Kii.logger("Setting expires at: "+this._expiresAt)},e.prototype.getAccessTokenObject=function(){var e;return e=null,null!=this._accessToken&&(e={access_token:this._accessToken,expires_at:this._expiresAt}),e},e.prototype.objectURI=function(){var e;return e=null,null!=this._uuid&&(e="kiicloud://users/"+this._uuid),e},e.prototype.set=function(e,t){return h.Kii.logger(this),h.Kii.logger(this._customInfo),this._customInfo[e]=t},e.prototype.get=function(e){return this._customInfo[e]},e.getCurrentUser=function(){return h.Kii.getCurrentUser()},e.userWithUsername=function(e,t){var i;return i=new h.KiiUser,i._setUsername(e),i._setPassword(t),i},e._userWithEmailAddress=function(e,t){var i;return i=new h.KiiUser,i._setEmailAddress(e),i._setPassword(t),i},e._userWithPhoneNumber=function(e,t){var i;return i=new h.KiiUser,i._setPhoneNumber(e),i._setPassword(t),i},e.userWithPhoneNumber=function(t,i){return e._userWithPhoneNumber(t,i)},e.userWithPhoneNumberAndUsername=function(e,t,i){var n;return n=new h.KiiUser,n._setPhoneNumber(e),n._setUsername(t),n._setPassword(i),n},e.userWithEmailAddress=function(t,i){return e._userWithEmailAddress(t,i)},e.userWithEmailAddressAndUsername=function(e,t,i){var n;return n=new h.KiiUser,n._setEmailAddress(e),n._setUsername(t),n._setPassword(i),n},e.userWithEmailAddressAndPhoneNumber=function(e,t,i){var n;return n=new h.KiiUser,n._setEmailAddress(e),n._setPhoneNumber(t),n._setPassword(i),n},e.userWithCredentials=function(e,t,i,n){var r;return r=new h.KiiUser,r._setEmailAddress(e),r._setPhoneNumber(t),r._setUsername(i),r._setPassword(n),r},e._validateURI=function(e){var t,i,n;return e=s._trim(e),i=/^kiicloud:\/\/users\/(.*$)/i,"string"===(typeof e).toLowerCase()&&(t=e.match(i),null!=t&&(n=t[1])),n},e.userWithID=function(e){var t;if(null==e||""===e)throw new h.InvalidArgumentException("userID should not null or empty");return t=new h.KiiUser,t._setUUID(e),t},e.userWithURI=function(e){var t,i;if(h.Kii.logger("About to extract from: "+e),i=h.KiiUser._validateURI(e),h.Kii.logger("Extracted uuid from uri: "+i),null==i)throw new h.InvalidURIException;return t=new h.KiiUser,t._setUUID(i),t},e.prototype.bucketWithName=function(e){var t;return t=new h.KiiBucket(e,this)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new h.KiiEncryptedBucket(e,this)},e.prototype._authenticate=function(e){var t,i,n,r,o,u;return h.Kii.logger("Authenticating user:"),h.Kii.logger(this),h.Kii.logger("Email verified: "+this._emailVerified),h.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?u=this._username:null!=this._emailAddress&&this._emailVerified===!0?u=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?u=this._phoneNumber:null!=this._emailAddress?u=this._emailAddress:null!=this._phoneNumber&&(u=this._phoneNumber),n={username:u,password:this._password},r=new Date,i=r.getTime(),h.Kii.getAccessTokenExpiration()>0&&(n.expiresAt=s._safeCalculateExpiresAtAsNumber(h.Kii.getAccessTokenExpiration(),i)),o=this._getRequest({path:"/oauth2/token",withApp:!1}),o.setAnonymous(!0),o.setMethod("POST"),o.setData(n),t={success:function(t){return function(n){return t._setUUID(n.id),t._clearPassword(),t._setAccessToken(n.access_token),null!=n.expires_in&&(r=new Date,i=r.getTime(),t._expiresAt=s._safeCalculateExpiresAtAsDate(n.expires_in,i)),h.Kii.setCurrentUser(t),null!=e?e.success(h.Kii.getCurrentUser()):void 0}}(this),failure:function(t){return function(i){return t._clearPassword(),null!=e?e.failure(t,i):void 0}}(this)},o.execute(t,!1)},e.prototype._authenticateWithToken=function(e,t,i){var n,r;return h.Kii.logger("Authenticating user "+this),h.Kii.logger(t),r=this._getRequest({path:"/users/me",withApp:!0}),r.setAnonymous(!0),r.addHeader("Authorization","Bearer "+e),n={success:function(n){return function(r){return n._updateWithJSON(r),n._setAccessToken(e),n._setExpiresAt("undefined"==typeof i?new Date(s.MAX_DATE_IN_MILLIS):i),h.Kii.setCurrentUser(n),null!=t?t.success(h.Kii.getCurrentUser()):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},r.execute(n,!1)},e.authenticate=function(e,t,i){var n,r;try{if(h.Kii.logger("UserIdentifier: "+e),!s._validatePassword(t))throw new h.InvalidPasswordException;if(s._validateEmail(e))r=h.KiiUser._userWithEmailAddress(e,t);else if(s._validatePhoneNumber(e))r=h.KiiUser._userWithPhoneNumber(e,t);else{if(!s._validateUsername(e))throw new h.InvalidUserIdentifierException;
r=h.KiiUser.userWithUsername(e,t)}return r._authenticate(i)}catch(o){if(n=o,null!=r&&r._clearPassword(),null!=i)return i.failure(null,n.message)}},e.authenticateWithToken=function(e,t,i){var n,r;if(n=s._type(i),"undefined"!==n&&"date"!==n)throw new h.InvalidArgumentException("Specified expiresAt must be a Date");return r=new h.KiiUser,r._authenticateWithToken(e,t,i)},e.prototype.register=function(e){var t,i,n,r,s,o;if(h.Kii.logger("Registering user "+this),t={password:this._password},null!=this._username&&(t.loginName=this._username),null!=this._displayName&&(t.displayName=this._displayName),null!=this._emailAddress&&(t.emailAddress=this._emailAddress),null!=this._phoneNumber&&(t.phoneNumber=this._phoneNumber),!this._validateLocalPhoneNumber(this._phoneNumber,this._country))return void e.failure(this,"needs to provide country for the local phone number");null!=this._country&&(t.country=this._country),h.Kii.logger("CINFO"),h.Kii.logger(this._customInfo),o=this._customInfo;for(i in o)s=o[i],h.Kii.logger("Key/val: "+i+"/"+s),t[i]=s;return r=this._getRequest({path:"/users",withApp:!0}),r.setMethod("POST"),r.setData(t),r.setAnonymous(!0),r.setContentType("application/vnd.kii.RegistrationRequest+json"),n={success:function(t){return function(i){return h.Kii.logger("Succreg"),t._updateWithJSON(i),t._authenticate(e)}}(this),failure:function(t){return function(i){return h.Kii.logger("Failreg"),t._clearPassword(),null!=e?e.failure(t,i):void 0}}(this)},r.execute(n,!1)},e.registerAsPseudoUser=function(e,t){var i,n,r,o,a;return r=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+"/users",o=u.createXHRWrapper("POST",r),a=o.xhr,a.setRequestHeader("x-kii-appid",h.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/vnd.kii.RegistrationAndAuthorizationRequest+json"),n={success:function(){var t,i,n,o;try{return a.status<300&&a.status>=200?(n=JSON.parse(a.responseText),t=n._accessToken,o=new h.KiiUser,o._updateWithJSON(n),o._setAccessToken(t),o._setExpiresAt(new Date(s.MAX_DATE_IN_MILLIS)),h.Kii.setCurrentUser(o),e.success(o)):(i=a.status+" : "+r,e.failure(null,i))}catch(u){return e.failure(null,"failed to parse response")}},failure:function(){var t,i;t="failed to register pseudo user. statusCode: "+a.status;try{if(i=JSON.parse(a.responseText),null!=i.errorCode&&(t+=" error code: "+i.errorCode),null!=i.message)return t+=" error message: "+i.message}catch(n){}finally{e.failure(null,t)}}},null==t&&(t={}),i=JSON.stringify(t),o.sendData(i,n)},e.prototype.putIdentity=function(e,t,i,n,r){var o,u,a,l,c,p,d,_,f;if(h.Kii.logger("Put identity user: "+this._uuid),u={},!this.isPseudoUser())return void(null!=i&&i.failure(null,"This user has the identity already"));if(null==e)return void(null!=i&&i.failure(null,"identityData is null"));try{this._validateIdentityData(e)}catch(g){return a=g,void(null!=i&&i.failure(null,a))}if(l=!1,null!=e.emailAddress&&(u.emailAddress=e.emailAddress,l=!0),null!=e.phoneNumber&&(u.phoneNumber=e.phoneNumber,l=!0),null!=e.username&&(u.loginName=e.username,l=!0),!l)return void(null!=i&&i.failure(null,"needs to provide at least one of login name, email address or phone number"));if(null==t)return void(null!=i&&i.failure(null,"password is null"));if(!s._validatePassword(t))return void(null!=i&&i.failure(null,"invalid password"));if(u.password=t,null!=n)for(c in n)d=n[c],u[c]=d;if(null!=r)for(_=0,f=r.length;f>_;_++)p=r[_],delete u[p];return o=null!=n?n.country:null,null==e.phoneNumber||this._validateLocalPhoneNumber(e.phoneNumber,o)?this.refresh({failure:function(){return function(e,t){return h.Kii.logger("Failreg"),null!=i?i.failure(null,t):void 0}}(this),success:function(t){return function(s){var o,a,l,c,p;return s.isPseudoUser()?(l=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+("/users/"+t._uuid),c=t._getXhrWrapper("POST",l),p=c.xhr,t._setAuthHeader(p),p.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),a={success:function(){var o,u;try{return u=JSON.parse(p.responseText),p.status<300&&p.status>=200?(s._setModified(u.modifiedAt),s._updateWithIdentityData(e),s._updateWithUserFields(n,r),t._hasPassword=!0,i.success(s)):(o=p.status+" : "+l,i.failure(null,o))}catch(a){return i.failure(null,"failed to parse response")}},failure:function(){var e,t;e="failed to put identity data. statusCode: "+p.status;try{if(t=JSON.parse(p.responseText),null!=t.errorCode&&(e+=" error code: "+t.errorCode),null!=t.message)return e+=" error message: "+t.message}catch(n){}finally{i.failure(null,e)}}},o=JSON.stringify(u),c.sendData(o,a)):void(null!=i&&i.failure(s,"This user has the identity already"))}}(this)}):void i.failure(this,"needs to provide country for the local phone number")},e.prototype.update=function(e,t,i,n){var r,s,o,u,a,l,c,p,d,_,f;if(h.Kii.logger("update user: "+this._uuid),s={},u=!1,l=!1,a=!1,null!=e){try{this._validateIdentityData(e)}catch(g){return o=g,void(null!=t&&t.failure(null,o))}null!=e.emailAddress&&(s.emailAddress=e.emailAddress,u=!0),null!=e.phoneNumber&&(s.phoneNumber=e.phoneNumber,u=!0),null!=e.username&&(s.loginName=e.username,u=!0)}if(null!=i)for(c in i)d=i[c],s[c]=d,l=!0;if(null!=n)for(_=0,f=n.length;f>_;_++)p=n[_],delete s[p],a=!0;return u||l||a?(r=null!=i?i.country:null,null==e||null==e.phoneNumber||this._validateLocalPhoneNumber(e.phoneNumber,r)?this.refresh({failure:function(){return function(e,i){return h.Kii.logger("Failreg"),null!=t?t.failure(null,i):void 0}}(this),success:function(r){return function(o){var a,l,c,p,d;return o.isPseudoUser()&&u?void(null!=t&&t.failure(o,"Pseudo user must use putIdentity()")):(c=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+("/users/"+r._uuid),p=r._getXhrWrapper("POST",c,!1),d=p.xhr,r._setAuthHeader(d),d.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),l={success:function(){var r,u;try{return u=JSON.parse(d.responseText),d.status<300&&d.status>=200?(o._setModified(s.modifiedAt),o._updateWithIdentityData(e),o._updateWithUserFields(i,n),t.success(o)):(r=d.status+" : "+c,t.failure(null,r))}catch(a){return t.failure(null,"failed to parse response")}},failure:function(){var e,i;e="failed to update user. statusCode: "+d.status;try{if(i=JSON.parse(d.responseText),null!=i.errorCode&&(e+=" error code: "+i.errorCode),null!=i.message)return e+=" error message: "+i.message}catch(n){}finally{t.failure(null,e)}}},a=JSON.stringify(s),p.sendData(a,l))}}(this)}):void t.failure(this,"needs to provide country for the local phone number")):void t.failure(this,"all arguments are null or empty")},e.prototype.updatePassword=function(e,t,i){var n,r,o,u;return h.Kii.logger("Updating password from "+e+" to "+t),s._validatePassword(t)?(n={oldPassword:e,newPassword:t},r="/users/"+this._uuid+"/password",o=this._getRequest({path:r,withApp:!0}),o.setMethod("PUT"),o.setData(n),o.setContentType("application/vnd.kii.ChangePasswordRequest+json"),u={success:function(e){return function(t,n){if(e._clearPassword,300>n&&n>=200){if(null!=i)return i.success(e)}else if(null!=i)return i.failure(e,"Unable to change password")}}(this),failure:function(e){return function(t){return e._clearPassword,null!=i?i.failure(e,t):void 0}}(this)},o.execute(u,!0)):null!=i?i.failure(this,(new h.InvalidPasswordException).message):void 0},e.resetPassword=function(e,t){var n,r,o,u;if(h.Kii.logger("Resetting password with identifier: "+e),s._validateEmail(e))n="EMAIL";else if(null!=t)return void t.failure("Invalid user identifier. Must be a valid email address");return null!=n?(r="/users/"+n+":"+e+"/password/request-reset",o=new i(r,!0),o.setMethod("POST"),o.setAnonymous(!0),u={success:function(e,i){return 300>i&&i>=200&&null!=t?t.success():null!=t?t.failure("Unable to reset password"):void 0},failure:function(e){return null!=t?t.failure(e):void 0}},o.execute(u,!0)):void 0},e.prototype.verifyCredentials=function(e,t,i){var n,r,s;return h.Kii.logger("Verifying "+e+" with code: "+t),n="/users/me/"+e+"/verify",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),r.setData({verificationCode:t}),r.setContentType("application/vnd.kii.AddressVerificationRequest+json"),s={success:function(t){return function(n,r){if(300>r&&r>=200){if("email-address"===e?t._setEmailVerified(!0):"phone-number"===e&&t._setPhoneVerified(!0),null!=i)return i.success(t)}else if(null!=i)return i.failure(t,"Unable to verify "+e)}}(this),failure:function(e){return function(t){return null!=i?i.failure(e,t):void 0}}(this)},r.execute(s,!0)},e.prototype.verifyPhoneNumber=function(e,t){return this.verifyCredentials("phone-number",e,t)},e.prototype.resendVerification=function(e,t){var i,n,r,s;return h.Kii.logger("Resending verification "+e),i=this.getID(),n="/users/"+i+"/"+e+"/resend-verification",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),s={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?t.success(i):null!=t?t.failure(i,"Unable to resend "+e+" verification"):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},r.execute(s,!0)},e.prototype.resendEmailVerification=function(e){return this.resendVerification("email-address",e)},e.prototype.resendPhoneNumberVerification=function(e){return this.resendVerification("phone-number",e)},e.prototype.memberOfGroups=function(e){var t,i,n;return h.Kii.logger("Getting groups for member "+this._uuid),i="/groups/?is_member="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],a=i.groups,o=0,u=a.length;u>o;o++)r=a[o],s.push(t._groupWithJSON(r));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,"Unable to retrieve groups")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(t,!1)},e.prototype.ownerOfGroups=function(e){var t,i,n;return h.Kii.logger("Getting groups owned by the user "+this._uuid),i="/groups/?owner="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,u,a;if(300>n&&n>=200){for(s=[],a=i.groups,o=0,u=a.length;u>o;o++)r=a[o],s.push(t._groupWithJSON(r));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,"Unable to retrieve groups")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(t,!1)},e.prototype.changePhone=function(e,t){var i,n,r;return h.Kii.logger("Updating phone number to "+e),i="/users/"+this._uuid+"/phone-number",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),n.setData({phoneNumber:e}),r={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?(i._setPhoneVerified(!1),i._setPhoneNumber(e),t.success(i)):null!=t?t.failure(i,"Unable to update phone number"):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!0)},e.prototype.changeEmail=function(e,t){var i,n,r;return h.Kii.logger("Updating email address to: "+e),s._validateEmail(e)?(i="/users/"+this._uuid+"/email-address",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),n.setData({emailAddress:e}),r={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?(i._setEmailVerified(!1),i._setEmailAddress(e),t.success(i)):null!=t?t.failure(i,"Unable to update email address"):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!0)):t.failure(this,"Invalid email address format")},e.prototype.save=function(e){var t,i,n,r;return h.Kii.logger("Saving user: "+this._uuid),i="/users/"+this._uuid,h.Kii.logger("CUSTOMINFO: "),h.Kii.logger(this._customInfo),n=this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),n.setContentType("application/vnd.kii.UserUpdateRequest+json"),t=this._customInfo,null!=this._country&&(t.country=this._country),null!=this._displayName&&(t.displayName=this._displayName),n.setData(t),r={success:function(t){return function(i,n){if(300>n&&n>=200){if(t._setModified(i.modifiedAt),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!1)},e.prototype.refresh=function(e){var t,i;return h.Kii.logger("Refreshing user: "+this._uuid),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),t={success:function(t){return function(i,n){if(300>n&&n>=200){if(t._updateWithJSON(i),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype["delete"]=function(e){var t,i;return h.Kii.logger("Deleting user..."),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e.logOut=function(){return h.Kii.logOut()},e.loggedIn=function(){return h.Kii.loggedIn()},e.prototype._updateWithIdentityData=function(e){return null!=e&&(null!=e.username&&(this._username=e.username),null!=e.emailAddress&&(this._emailAddress=e.emailAddress),null!=e.phoneNumber)?this._phoneNumber=e.phoneNumber:void 0},e.prototype._updateWithUserFields=function(e,t){var i,n,r,s,o,u;if(null!=e)for(i in e)r=e[i],"displayName"===i?this._displayName=r:"country"===i?this._country=r:""===i?(h.Kii.logger("Setting empty to custom info"),this._customInfo[i]=r):i.substring(0,!0)&&(h.Kii.logger("Setting to custom info"),this._customInfo[i]=r);if(null!=t){for(u=[],s=0,o=t.length;o>s;s++)n=t[s],u.push(delete this._customInfo[n]);return u}},e.prototype._validateIdentityData=function(e){if(null!=e){if(null!=e.emailAddress&&!s._validateEmail(e.emailAddress))throw"invalid email";if(null!=e.phoneNumber&&!s._validatePhoneNumber(e.phoneNumber))throw"invalid phone number";if(null!=e.username&&!s._validateUsername(e.username))throw"invalid username"}},e.prototype._validateLocalPhoneNumber=function(e,t){return null==e||s._isGlobalPhoneNumber(e)?!0:null!=t?s._validateCountryCode(t):!1},e.prototype._updateWithJSON=function(e){var t,i,n,r;h.Kii.logger("Updating with:"),h.Kii.logger(e),this._thirdPartyAccounts={},r=[];for(t in e)n=e[t],h.Kii.logger("key/val => "+t+"/"+n),h.Kii.logger("Substr "+t.substring(0,1)),"userID"===t||"id"===t?r.push(this._uuid=n):"created"===t||"createdAt"===t||"_created"===t?r.push(this._created=n):"modified"===t||"modifiedAt"===t||"_modified"===t?r.push(this._modified=n):"loginName"===t?r.push(this._username=n):"displayName"===t?r.push(this._displayName=n):"country"===t?(h.Kii.logger("Is setting country"),r.push(this._country=n)):"emailAddress"===t?r.push(this._emailAddress=n):"phoneNumber"===t?r.push(this._phoneNumber=n):"emailAddressVerified"===t?(h.Kii.logger("Email verified: "+n),r.push(this._emailVerified=n)):"phoneNumberVerified"===t?(h.Kii.logger("Phone verified: "+n),r.push(this._phoneVerified=n)):"_hasPassword"===t?(h.Kii.logger("_hasPassword: "+n),r.push(this._hasPassword=n)):"_thirdPartyAccounts"===t?(null!=n.hotmail&&(i=n.hotmail,i.type="live",n.live=i,delete n.hotmail),h.Kii.logger("_thirdPartyAccounts: "+n),r.push(this._thirdPartyAccounts=n)):"_disabled"===t?(h.Kii.logger("disabled: "+n),r.push(this._disabled=n)):""===t?(h.Kii.logger("Setting empty to custom info"),r.push(this._customInfo[t]=n)):t.substring(0,!0)?(h.Kii.logger("Setting to custom info"),r.push(this._customInfo[t]=n)):r.push(h.Kii.logger("Doing nothing"));return r},e.prototype._getRequest=function(e){var t,n,r;return t=e.path,r=e.withApp,n=new i(t,r)},e.findUserByEmail=function(t,i){if(null==h.KiiUser.getCurrentUser()||null==h.KiiUser.getCurrentUser().getAccessToken())throw new h.IllegalStateException("User is not logged in");return e._findUserByEmail(t,i)},e._findUserByEmail=function(t,i,n){var r;if(null==t||""===t)throw new h.InvalidArgumentException("email should not null or empty");return r=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+("/users/EMAIL:"+t),e._findUserRequestImpl(r,i,n)},e.findUserByPhone=function(t,i){if(null==h.KiiUser.getCurrentUser()||null==h.KiiUser.getCurrentUser().getAccessToken())throw new h.IllegalStateException("User is not logged in");return e._findUserByPhone(t,i)},e._findUserByPhone=function(t,i,n){var r;if(null==t||""===t)throw new h.InvalidArgumentException("phone should not null or empty");return r=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+("/users/PHONE:"+t),e._findUserRequestImpl(r,i,n)},e.findUserByUsername=function(t,i){if(null==h.KiiUser.getCurrentUser()||null==h.KiiUser.getCurrentUser().getAccessToken())throw new h.IllegalStateException("User is not logged in");return e._findUserByUsername(t,i)},e._findUserByUsername=function(t,i,n){var r;if(null==t||""===t)throw new h.InvalidArgumentException("username should not null or empty");return r=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+("/users/LOGIN_NAME:"+t),e._findUserRequestImpl(r,i,n)},e._findUserRequestImpl=function(e,t,i){var n,r,s;if(null==t||null==t.success||null==t.failure)throw new h.InvalidArgumentException("Callback should not be null, and should exist success and failure methods.");return r=u.createXHRWrapper("GET",e),s=r.xhr,s.setRequestHeader("x-kii-appid",h.Kii.getAppID()),s.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),s.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),null!=i?s.setRequestHeader("Authorization","Bearer "+i._getToken()):s.setRequestHeader("Authorization","Bearer "+h.KiiUser.getCurrentUser().getAccessToken()),n={success:function(){var e,n;if(null!=t)try{return e=JSON.parse(s.responseText),null!=i?(n=new h.KiiUserAdmin(i._getToken()),n._updateWithJSON(e),t.success(i,n)):(n=new h.KiiUser,n._updateWithJSON(e),t.success(n))}catch(r){return null!=i?t.failure(i,"Unable to parse response"):t.failure("Unable to parse response")}},failure:function(){var e,n;if(null!=t){e="Failed to find user. statusCode: "+s.status;try{if(n=JSON.parse(s.responseText),null!=n.errorCode&&(e+=" error code: "+n.errorCode),null!=n.message)return e+=" error message: "+n.message}finally{null!=i?t.failure(i,e):t.failure(e)}}}},r.send(n)},e.prototype._getXhrWrapper=function(e,t){var i,n;return i=u.createXHRWrapper(e,t),n=i.xhr,n.setRequestHeader("x-kii-appid",h.Kii.getAppID()),n.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),n.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),i},e.prototype._setAuthHeader=function(e){var t;return t=h.KiiUser.getCurrentUser(),null!=t?e.setRequestHeader("Authorization","Bearer "+t.getAccessToken()):void 0},e.prototype._groupWithJSON=function(e){return h.KiiGroup._groupWithJSON(e)},e}(),s=function(){function e(){}return e.MAX_DATE_IN_MILLIS=864e13,e.MIN_DATE_IN_MILLIS=-864e13,e._validateEmail=function(t){var i;return t=e._trim(t),i=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i,"string"!==(typeof t).toLowerCase()?(h.Kii.logger("Not string"),!1):t.match(i)?!0:!1},e._validatePhoneNumber=function(t){var i;return t=e._trim(t),i=/^[\\+]?[0-9]{10,}$/i,"string"!==(typeof t).toLowerCase()?(h.Kii.logger("Not string"),!1):t.match(i)?!0:!1},e._isGlobalPhoneNumber=function(t){var i;return t=e._trim(t),i=/^[\\+]{1}[0-9]{2}/,"string"!==(typeof t).toLowerCase()?(h.Kii.logger("Not string"),!1):t.match(i)?!0:!1},e._validateLocalPhone=function(t){var i;return t=e._trim(t),i=/^\d+$/,"string"!==(typeof t).toLowerCase()?(h.Kii.logger("Not string"),!1):t.match(i)?!0:(h.Kii.logger("Invalid format"),!1)},e._assertLocalPhoneIsValid=function(t){if(!e._validateLocalPhone(t))throw new h.InvalidLocalPhoneNumberException},e._validateCountryCode=function(t){var i;return t=e._trim(t),i=/^[a-z]{2}$/i,"string"!==(typeof t).toLowerCase()?(h.Kii.logger("Not string"),!1):t.match(i)?(h.Kii.logger("Is true"),!0):!1},e._assertCountryCodeIsValid=function(t){if(!e._validateCountryCode(t))throw new h.InvalidCountryException},e._validatePassword=function(e){var t;return h.Kii.logger("Validating password: "+e),t=/^[\x20-\x7E]{4,50}$/,"string"!==(typeof e).toLowerCase()?(h.Kii.logger("not string"),!1):e.match(t)?(h.Kii.logger("matched"),!0):(h.Kii.logger("other exception"),!1)},e._assertPasswordIsValid=function(t){if(!e._validatePassword(t))throw new h.InvalidPasswordException},e._validateUsername=function(e){var t;return t=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof e).toLowerCase()?!1:e.match(t)?!0:!1},e._validateDisplayName=function(t){var i;return"string"===e._type(t)&&1<=(i=t.length)&&50>=i},e._trim=function(e){var t;return t=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,(e||"").replace(t,"")},e._safeAddTicks=function(t,i){if(isNaN(parseInt(t,10))||isNaN(parseInt(i,10)))throw new h.InvalidArgumentException("Parameters should be a number");if(Math.abs(t+i)>e.MAX_DATE_IN_MILLIS)throw new h.ArithmeticException("Addition of "+t+" and "+i+" result in long overflow");return t+i},e._safeMultiplyTicks=function(t,i){if(isNaN(parseInt(t,10))||isNaN(parseInt(i,10)))throw new h.InvalidArgumentException("Parameters should be a number");if(Math.abs(t*i)>e.MAX_DATE_IN_MILLIS)throw new h.ArithmeticException("Multiplication of "+t+" and "+i+" result in long overflow");return t*i},e._safeCalculateExpiresAtAsNumber=function(t,i){var n,r,s;s=0;try{r=e._safeMultiplyTicks(t,1e3),s=e._safeAddTicks(i,r)}catch(o){if(n=o,!(n instanceof h.ArithmeticException))throw n;s=e.MAX_DATE_IN_MILLIS}return s},e._safeCalculateExpiresAtAsDate=function(t,i){var n,r,s;s=0;try{r=e._safeMultiplyTicks(t,1e3),s=e._safeAddTicks(i,r)}catch(o){if(n=o,!(n instanceof h.ArithmeticException))throw n;s=e.MAX_DATE_IN_MILLIS}return new Date(s)},e._isJSONType=function(e){var t;return t=/\+?json(;.*)?$/i,e.match(t)},e._type=function(e){var t;return void 0===e||null===e?String(e):(t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},t[Object.prototype.toString.call(e)])},e._disableCacheURL=function(e){return e+=-1!==e.indexOf("?")?"&disable_cache=":"?disable_cache=",e+=(new Date).getTime()},e._validateServerCodeEntryName=function(t){var i;return i=/^[a-zA-Z][_a-zA-Z0-9]*$/i,"string"===e._type(t)&&t.match(i)},e._validateServerCodeEntryArgument=function(t){return"null"===e._type(t)||"object"===e._type(t)&&Object.keys(t).length>0},e._validateServerCodeEnryVersion=function(t){return"string"===e._type(t)&&""!==t},e}(),h.KiiSocialConnect=function(){function e(){}var t;return t=null,e.setupNetwork=function(e,i,n,r){var s;return null==t&&(t=new c),s=t._getManager(e),s._reset(),s._setup(i,n,r),h.Kii.logger("Set key: "+s._key)},e.logIn=function(e,i,n){var r;return r=!1,null!=t&&(h.Kii.logger("And manager: "),h.Kii.logger(t._getManager(e)),t._getManager(e)&&(t._getManager(e)._logIn(i,n),r=!0)),h.Kii.logger("Callbacks"),h.Kii.logger(n),r||null==n?void 0:n.failure(h.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.linkCurrentUserWithNetwork=function(e,i,n){var r;return h.Kii.logger("Trying with instance"),h.Kii.logger(t),r=!1,null!=t&&(h.Kii.logger("And manager: "),h.Kii.logger(t._getManager(e)),t._getManager(e)&&(t._getManager(e)._linkWithCurrentUser(i,n),r=!0)),h.Kii.logger("Callbacks"),h.Kii.logger(n),r||null==n?void 0:n.failure(h.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.unLinkCurrentUserFromNetwork=function(e,i){if(h.Kii.logger("Trying with instance"),h.Kii.logger(t),null!=t){if(h.Kii.logger("And manager: "),h.Kii.logger(t._getManager(e)),t._getManager(e))return t._getManager(e)._unlinkFromCurrentUser(i)}else if(null!=i)return i.failure(h.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.getAccessTokenForNetwork=function(e){return t._getManager(e)._getToken()},e.getAccessTokenExpirationForNetwork=function(e){return t._getManager(e)._getTokenExpiration()},e.getAccessTokenObjectForNetwork=function(e){return t._getManager(e)._getTokenObject()},e.logOutAll=function(){var e,i,n;return null!=t&&(e=t._getManager(h.KiiSocialNetworkName.FACEBOOK),null!=e&&e._logOut(),n=t._getManager(h.KiiSocialNetworkName.TWITTER),null!=n&&n._logOut(),i=t._getManager(h.KiiSocialNetworkName.QQ),null!=i)?i._logOut():void 0},e}(),c=function(){function e(){this._getManager=p(this._getManager,this)}return e.prototype._getManager=function(e){return e===h.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new h.KiiSCNFacebook:e===h.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new h.KiiSCNTwitter:e===h.KiiSocialNetworkName.QQ?null!=this._qqManager?this._qqManager:this._qqManager=new h.KiiSCNQQ:void 0},e}(),h.KiiSocialConnectNetwork=function(){function e(e){this._network=e,this._setup=p(this._setup,this),this._unlinkFromCurrentUser=p(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=p(this._linkWithCurrentUser,this),this._logOut=p(this._logOut,this),this._logIn=p(this._logIn,this),this._reset=p(this._reset,this),this._isAuthenticated=p(this._isAuthenticated,this),this._getCallbacks=p(this._getCallbacks,this),this._setCallbacks=p(this._setCallbacks,this),this._getTokenObject=p(this._getTokenObject,this),this._setTokenObject=p(this._setTokenObject,this),this._getTokenExpiration=p(this._getTokenExpiration,this),this._setTokenExpiration=p(this._setTokenExpiration,this),this._getToken=p(this._getToken,this),this._setToken=p(this._setToken,this),this._getExtras=p(this._getExtras,this),this._setExtras=p(this._setExtras,this),this._getSecret=p(this._getSecret,this),this._setSecret=p(this._setSecret,this),this._getKey=p(this._getKey,this),this._setKey=p(this._setKey,this),this._getNetwork=p(this._getNetwork,this),this._setNetwork=p(this._setNetwork,this)}return e.prototype._className="KiiSocialConnectNetwork",e.prototype._setNetwork=function(e){this._network=e},e.prototype._getNetwork=function(){return this._network},e.prototype._setKey=function(e){this._key=e},e.prototype._getKey=function(){return this._key},e.prototype._setSecret=function(e){this._secret=e},e.prototype._getSecret=function(){return this._secret},e.prototype._setExtras=function(e){this._extras=e},e.prototype._getExtras=function(){return this._extras},e.prototype._setToken=function(e){this._token=e},e.prototype._getToken=function(){return this._token},e.prototype._setTokenExpiration=function(e){this._tokenExpiration=e},e.prototype._getTokenExpiration=function(){return this._tokenExpiration},e.prototype._setTokenObject=function(e){this._tokenObject=e},e.prototype._getTokenObject=function(){return this._tokenObject},e.prototype._setCallbacks=function(e){this._callbacks=e},e.prototype._getCallbacks=function(){return this._callbacks},e.prototype._isAuthenticated=function(){return null!=this._tokenObject},e.prototype._reset=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null,this._key=null,this._secret=null,this._extras=null},e.prototype._logIn=function(e,t){this._callbacks=t},e.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},e.prototype._linkWithCurrentUser=function(e,t){this._callbacks=t},e.prototype._unlinkFromCurrentUser=function(e){this._callbacks=e},e.prototype._setup=function(e,t,i){this._key=e,this._secret=t,this._extras=i},e}(),h.KiiSCNFacebook=function(e){function t(){this._unlinkFromCurrentUser=p(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=p(this._linkWithCurrentUser,this),this._logOut=p(this._logOut,this),this._logIn=p(this._logIn,this),this._unlink=p(this._unlink,this),this._link=p(this._link,this),this._register=p(this._register,this),this._setup=p(this._setup,this),t.__super__.constructor.call(this,h.KiiSocialNetworkName.FACEBOOK)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras),this._extras.appId=this._key,this._extras.version="v2.1",h.Kii.logger(this._extras),FB.init(this._extras)},t.prototype._register=function(e,t){var n,r,o,u,a;return a={accessToken:e},r=new Date,n=r.getTime(),h.Kii.getAccessTokenExpiration()>0&&(a.expiresAt=s._safeCalculateExpiresAtAsNumber(h.Kii.getAccessTokenExpiration(),n)),u=new i("/integration/facebook",!0),u.setMethod("POST"),u.setData(a),u.setAnonymous(!0),u.setContentType("application/vnd.kii.AuthTokenFacebookRequest+json"),o={success:function(i){return function(o){var u,a,l;return i._setToken(e),i._setTokenExpiration(t),u={access_token:e,expires_in:t},i._setTokenObject(u),a=new h.KiiUser,a._updateWithJSON(o),a._setAccessToken(o.access_token),null!=o.expires_in&&(r=new Date,n=r.getTime(),l=s._safeCalculateExpiresAtAsDate(o.expires_in,n),a._setExpiresAt(l)),h.Kii.setCurrentUser(a),null!=i._callbacks?i._callbacks.success(h.KiiUser.getCurrentUser(),i._network):void 0}}(this),failure:function(e){return function(t){return null!=e._callbacks?e._callbacks.failure(null,e._network,t):void 0}}(this)},u.execute(o,!1)},t.prototype._link=function(e,t){var n,r;return r=new i("/users/me/facebook/link",!0),r.setMethod("POST"),r.setData({accessToken:e}),n={success:function(i){return function(){var n;return i._setToken(e),i._setTokenExpiration(t),n={access_token:e,expires_in:t},i._setTokenObject(n),null!=i._callbacks?i._callbacks.success(h.KiiUser.getCurrentUser(),i._network):void 0}}(this),failure:function(e){return function(t){return null!=e._callbacks?e._callbacks.failure(h.KiiUser.getCurrentUser(),e._network,t):void 0}}(this)},r.execute(n,!0)},t.prototype._unlink=function(){var e,t;return e=new i("/users/me/facebook/unlink",!0),e.setMethod("POST"),t={success:function(e){return function(){return e._setToken(null),e._setTokenExpiration(null),e._setTokenObject(null),null!=e._callbacks?e._callbacks.success(h.KiiUser.getCurrentUser(),e._network):void 0}}(this),failure:function(e){return function(t){return null!=e._callbacks?e._callbacks.failure(h.KiiUser.getCurrentUser(),e._network,t):void 0}}(this)},e.execute(t,!0)},t.prototype._logIn=function(e,i){var n,r,s;return t.__super__._logIn.call(this,e,i),h.Kii.logger("should auth fb"),h.Kii.logger("Checking options"),h.Kii.logger(e),n=function(e){return function(t){return null!=t.authResponse?(null!=h.KiiUser.getCurrentUser()&&h.KiiUser.logOut(),e._register(t.authResponse.accessToken,t.authResponse.expiresIn)):null!=e._callbacks?e._callbacks.failure(null,e._network,"User cancelled login or did not fully authorize"):void 0}}(this),null!=e&&null!=e.access_token?(h.Kii.logger("Have options: "),h.Kii.logger(e),null!=h.KiiUser.getCurrentUser()&&h.KiiUser.logOut(),this._register(e.access_token,null)):(r=null,null!=e&&null!=e.scope&&(r={scope:e.scope}),s=function(e){return"connected"===e.status?n(e):FB.login(n,r)},FB.getLoginStatus(s))},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),h.Kii.logger("Log out fb")},t.prototype._linkWithCurrentUser=function(e,i){var n,r,s;return t.__super__._linkWithCurrentUser.call(this,e,i),n=function(e){return function(t){return t.authResponse?e._link(t.authResponse.accessToken,t.authResponse.expiresIn):null!=e._callbacks?e._callbacks.failure(null,e._network,"User cancelled Facebook login or did not fully authorize"):void 0}}(this),null!=h.KiiUser.getCurrentUser()?null!=e&&null!=e.access_token?this._link(e.access_token,null):(r=null,null!=e&&null!=e.scope&&(r={scope:e.scope}),s=function(e){return"connected"===e.status?n(e):FB.login(n,r)
},FB.getLoginStatus(s)):null!=i?i.failure("A KiiUser must be logged in before linking to Facebook"):void 0},t.prototype._unlinkFromCurrentUser=function(e){return t.__super__._unlinkFromCurrentUser.call(this,e),null!=h.KiiUser.getCurrentUser()?this._unlink():null!=e?e.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},t}(h.KiiSocialConnectNetwork),h.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 1-50 characters."},h.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},h.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"},h.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"},h.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},h.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},h.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},h.InvalidCountryException=function(){return this.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},h.InvalidURIException=function(){return this.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},h.InvalidACLAction=function(){return this.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},h.InvalidACLSubject=function(){return this.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},h.InvalidACLGrant=function(){return this.message="Unable to set ACL grant. Must be a boolean type"},h.InvalidLimitException=function(){return this.message="Unable to set query limit. Must be an integer > 0"},h.InvalidArgumentException=function(e){return this.message="InvalidArgument: "+e},h.IllegalStateException=function(e){return this.message="IllegalState: "+e},h.ArithmeticException=function(e){return this.message="ArithmeticException"+e},h.KiiAppAdminContext=function(){function e(e){this._getToken=p(this._getToken,this),this._getId=p(this._getId,this),this._objectWithURI=p(this._objectWithURI,this),this._token=e.token,this._id=e.id}return e.prototype.bucketWithName=function(e){var t;return t=new h.KiiBucketAdmin(e,null,this._token)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new h.KiiEncryptedBucketAdmin(e,null,this._token)},e.prototype.groupWithName=function(e){var t;return t=h.KiiGroupAdmin._groupWithName(e,this._token)},e.prototype.userWithID=function(e){var t;return t=h.KiiUserAdmin._userWithID(e,this._token)},e.prototype.objectWithURI=function(e){var t;return t=this._objectWithURI(e)},e.prototype._userWithLoginName=function(e,t){var i,n,r;return r=new h.KiiUserAdmin(this._token),n=r._getRequest({path:"/users/LOGIN_NAME:"+e,withApp:!0}),n.setAdminToken(this._token),i={success:function(){return function(e,i){if(300>i&&i>=200){if(r._updateWithJSON(e),null!=t)return t.success(r)}else if(null!=t)return t.failure("Unable to parse response")}}(this),failure:function(){return function(e){return null!=t?t.failure(e):void 0}}(this)},n.execute(i,!1)},e.prototype._objectWithURI=function(e){var t,i,n,r,s,o,u,a,l,c,p;if(!e)throw new h.InvalidURIException;if(p=0===e.indexOf("kiicloud://"),u=e.substr("kiicloud://".length),s=u.split("/"),r=s.length,!(r>=4&&p))throw new h.InvalidURIException;if(i=4===r?1:3,n=s[i],"groups"===s[0]&&6===r)o=new h.KiiGroupAdmin._groupWithID(s[1],this._token);else if("users"===s[0]&&6===r)c=h.KiiUserAdmin._userWithID(s[1],this._token);else if(4!==r)throw new h.InvalidURIException;return l=null,null!=o?l=o:null!=c&&(l=c),t=new h.KiiBucketAdmin(n,l,this._token),a=t.createObject(),a._setUUID(s[r-1]),a},e.prototype._getId=function(){return this._id},e.prototype._getToken=function(){return this._token},e.prototype.groupWithID=function(e){var t;if(null==e||""===e)throw new h.InvalidArgumentException("groupID should not null or empty");return t=h.KiiGroupAdmin._groupWithID(e,this._token)},e.prototype.groupWithURI=function(e){var t,i,n;if(null==e)throw new h.InvalidURIException;if(0!==e.indexOf("kiicloud://"))throw new h.InvalidURIException;if(n=e.substr("kiicloud://".length),t=n.split("/"),2!==t.length||"groups"!==t[0])throw new h.InvalidURIException;return i=h.KiiGroupAdmin._groupWithID(t[1],this._token)},e.prototype.findUserByEmail=function(e,t){return h.KiiUser._findUserByEmail(e,t,this)},e.prototype.findUserByPhone=function(e,t){return h.KiiUser._findUserByPhone(e,t,this)},e.prototype.findUserByUsername=function(e,t){return h.KiiUser._findUserByUsername(e,t,this)},e}(),h.KiiACLAdmin=function(e){function t(e,i){this._userWithID=p(this._userWithID,this),this._groupWithID=p(this._groupWithID,this),this._getRequest=p(this._getRequest,this),t.__super__.constructor.call(this),this._setParent(e),this._adminToken=i}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._groupWithID=function(e){var t;return t=h.KiiGroupAdmin._groupWithID(e,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=h.KiiUserAdmin._userWithID(e,this._adminToken)},t}(h.KiiACL),h.KiiGroupAdmin=function(e){function t(e){this._setOwnerFromContext=p(this._setOwnerFromContext,this),this._userWithID=p(this._userWithID,this),this.bucketWithName=p(this.bucketWithName,this),this._getRequest=p(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t._groupWithName=function(e,t){return h.KiiGroupAdmin._groupWithNameAndMembers(e,null,t)},t._groupWithNameAndMembers=function(e,t,i){var n;return n=new h.KiiGroupAdmin(i),n._setName(e),n._setAddMembers(t),n},t._groupWithID=function(e,t){var i;return i=new h.KiiGroupAdmin(t),i._setUUID(e),i},t.prototype.bucketWithName=function(e){var t;return t=new h.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){var t;return t=new h.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=h.KiiUserAdmin._userWithID(e,this._adminToken)},t.prototype._setOwnerFromContext=function(){},t._groupWithJSON=function(e,t){var i;return i=new h.KiiGroupAdmin(t),null!=e.groupID&&i._setUUID(e.groupID),null!=e.name&&i._setName(e.name),null!=e.owner&&i._setOwner(h.KiiUserAdmin._userWithID(e.owner,t)),i},t}(h.KiiGroup),h.KiiObjectAdmin=function(e){function t(e){this._userWithID=p(this._userWithID,this),this.objectACL=p(this.objectACL,this),this._getToken=p(this._getToken,this),this._getRequest=p(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return _(t,e),t.prototype._getRequest=function(e){var i;return h.Kii.logger("admin req: "+this._adminToken),i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._getToken=function(){return this._adminToken?this._adminToken:null},t.objectWithBucket=function(e,t,i){var n;return h.Kii.logger("Creating object w type: "+t),n=new h.KiiObjectAdmin(i),n._setBucket(e),n._setObjectType(t),h.Kii.logger(n),n},t.objectWithID=function(e,t,i){var n;return h.Kii.logger("Creating object w id: "+t),n=new h.KiiObjectAdmin(i),n._setBucket(e),n._setUUID(t),h.Kii.logger(n),n},t.prototype.objectACL=function(){var e;return e=new h.KiiACLAdmin(this,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=h.KiiUserAdmin._userWithID(e,this._adminToken)},t}(h.KiiObject),h.KiiUserAdmin=function(e){function t(e){this._groupWithJSON=p(this._groupWithJSON,this),this.bucketWithName=p(this.bucketWithName,this),this._setAuthHeader=p(this._setAuthHeader,this),this._getRequest=p(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return _(t,e),t._userWithID=function(e,t){var i;return i=new h.KiiUserAdmin(t),i._setUUID(e),i},t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._setAuthHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this._adminToken)},t.prototype.bucketWithName=function(e){var t;return t=new h.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){var t;return t=new h.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype._groupWithJSON=function(e){var t;return t=new h.KiiGroupAdmin._groupWithJSON(e,this._adminToken)},t}(h.KiiUser),h.KiiAnonymousUser=function(){function e(){}return e}(),h.KiiAnyAuthenticatedUser=function(){function e(){}return e}(),h.KiiSDKClientInfo=function(){function e(){}return e.getSDKClientInfo=function(){return null==e._clientInfo&&(e._clientInfo="sn=jss;sv="+h.Kii.getSDKVersion()),e._clientInfo},e}(),h.KiiSCNTwitter=function(e){function t(){this._unlinkFromCurrentUser=p(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=p(this._linkWithCurrentUser,this),this._logOut=p(this._logOut,this),this._logIn=p(this._logIn,this),this._unlink=p(this._unlink,this),this._link=p(this._link,this),this._register=p(this._register,this),this._setup=p(this._setup,this),t.__super__.constructor.call(this,h.KiiSocialNetworkName.TWITTER)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._register=function(e,t){var n,r,o,u,a;return a={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},r=new Date,n=r.getTime(),h.Kii.getAccessTokenExpiration()>0&&(a.expiresAt=s._safeCalculateExpiresAtAsNumber(h.Kii.getAccessTokenExpiration(),n)),u=new i("/integration/twitter",!0),u.setMethod("POST"),u.setData(a),u.setAnonymous(!0),u.setContentType("application/vnd.kii.AuthTokenTwitterRequest+json"),o={success:function(i){return function(o){var u,a,l;return i._setToken(e.oauth_token),u={oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret},i._setTokenObject(u),a=new h.KiiUser,a._updateWithJSON(o),a._setAccessToken(o.access_token),null!=o.expires_in&&(r=new Date,n=r.getTime(),l=s._safeCalculateExpiresAtAsDate(o.expires_in,n),a._setExpiresAt(l)),h.Kii.setCurrentUser(a),null!=t?t.success(h.KiiUser.getCurrentUser(),i._network):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(null,e._network,i):void 0}}(this)},u.execute(o,!1)},t.prototype._link=function(e,t){var n,r,s;return s=new i("/users/me/twitter/link",!0),s.setMethod("POST"),n={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},s.setData(n),r={success:function(i){return function(){var n;return i._setToken(e.oauth_token),n={oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret},i._setTokenObject(n),null!=t?t.success(h.KiiUser.getCurrentUser(),i._network):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(h.KiiUser.getCurrentUser(),e._network,i):void 0}}(this)},s.execute(r,!0)},t.prototype._unlink=function(e){var t,n;return t=new i("/users/me/twitter/unlink",!0),t.setMethod("POST"),n={success:function(t){return function(){return t._setToken(null),t._setTokenObject(null),null!=e?e.success(h.KiiUser.getCurrentUser(),t._network):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(h.KiiUser.getCurrentUser(),t._network,i):void 0}}(this)},t.execute(n,!0)},t.prototype._logIn=function(e,i){if(t.__super__._logIn.call(this,e,i),h.Kii.logger("Checking options"),h.Kii.logger(e),null==e||!e.oauth_token&&!e.oauth_token_secret)throw h.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!e.oauth_token)throw h.InvalidArgumentException("options.oauth_token is required");if(!e.oauth_token_secret)throw h.InvalidArgumentException("options.oauth_token_secret is required");return null!=h.KiiUser.getCurrentUser()&&h.KiiUser.logOut(),this._register(e,i)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),h.Kii.logger("Log out twitter")},t.prototype._linkWithCurrentUser=function(e,t){if(null==h.KiiUser.getCurrentUser())return void t.failure(null,this._network,"No user logged in");if(null==e||!e.oauth_token&&!e.oauth_token_secret)throw h.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!e.oauth_token)throw h.InvalidArgumentException("options.oauth_token is required");if(!e.oauth_token_secret)throw h.InvalidArgumentException("options.oauth_token_secret is required");return this._link(e,t)},t.prototype._unlinkFromCurrentUser=function(e){return null==h.KiiUser.getCurrentUser()?void e.failure(null,this._network,"No user logged in"):this._unlink(e)},t}(h.KiiSocialConnectNetwork),h.KiiGeoPoint=function(){function e(e,t){var i;if(this._latitude=e,this._longitude=t,this._toDict=p(this._toDict,this),this.getLongitude=p(this.getLongitude,this),this.getLatitude=p(this.getLatitude,this),i=function(e,t,i){return i>e&&t>i&&!isNaN(i)},!i(-90,90,e)||!i(-180,180,t))throw h.InvalidArgumentException("Specified latitide or longitude is invalid")}return e.prototype.getLatitude=function(){return this._latitude},e.prototype.getLongitude=function(){return this._longitude},e.geoPoint=function(e,t){return new h.KiiGeoPoint(e,t)},e.prototype._toDict=function(){var e;return e={_type:"point",lat:this._latitude,lon:this._longitude}},e}(),t=function(){function e(e,t,i){this.xhr=$.ajaxSettings.xhr(),t=s._disableCacheURL(t),this.xhr.open(e,t,!0),this.xhr.onreadystatechange=i.onComplete}return e}(),a=function(){function e(e,t,i){t=s._disableCacheURL(t),this.xhr=new XMLHttpRequest,"withCredentials"in this.xhr?(this.xhr.open(e,t,!0),this.xhr.onreadystatechange=i.onComplete):this.xhr=null}return e}(),r=function(){function e(e,t,i){this.xhr=Ti.Network.createHTTPClient(),t=s._disableCacheURL(t),this.xhr.open(e,t,!0),this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError}return e}(),u=function(){function t(){}return t.createXHRWrapper=function(t,i){var r;return r=null,null===h.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(h.Kii.logger("Use jQuery"),r=new e(t,i)):"undefined"!=typeof XMLHttpRequest?(h.Kii.logger("Use XMLHttpRequest"),r=new o(t,i)):"undefined"!=typeof Titanium&&(h.Kii.logger("Use Titanium"),r=new n(t,i)):(h.Kii.logger("Use http request backdoor"),h.Kii._getHttpRequestType()===h._KiiHttpRequestType.jQuery?(h.Kii.logger("Use jQuery"),r=new e(t,i)):h.Kii._getHttpRequestType()===h._KiiHttpRequestType.XMLHttpRequest?(h.Kii.logger("Use XMLHttpRequest"),r=new o(t,i)):h.Kii._getHttpRequestType()===h._KiiHttpRequestType.Titanium&&(h.Kii.logger("Use Titanium"),r=new n(t,i))),r},t}(),o=function(){function e(e,t){this.sendData=p(this.sendData,this),this.send=p(this.send,this),this._setUpCallbacks=p(this._setUpCallbacks,this);var i,n,r;if(t=s._disableCacheURL(t),this.xhr=new XMLHttpRequest,this.method=e,"withCredentials"in this.xhr){if(this.xhr.open(e,t,!0),i=h.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}else this.xhr=null}return e.prototype._setUpCallbacks=function(e){return e&&e.progress?"PUT"===this.method?this.xhr.upload.addEventListener("progress",e.progress,!1):this.xhr.addEventListener("progress",e.progress,!1):void 0},e.prototype.send=function(e){var t;return this._setUpCallbacks(e),t={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(h.Kii.logger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(h.Kii.logger("Error loading data..."),h.Kii.logger("callback : "+e),null!=e)return e.failure()}}(this)},this.xhr.onreadystatechange=t.onComplete,this.xhr.send()},e.prototype.sendData=function(e,t){var i;return this._setUpCallbacks(t),i={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(h.Kii.logger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(h.Kii.logger("Error loading data..."),null!=t)return t.failure()}}(this)},this.xhr.onreadystatechange=i.onComplete,this.xhr.send(e)},e}(),n=function(e){function t(e,t){this.sendData=p(this.sendData,this),this.send=p(this.send,this);var i,n,r;if(t=s._disableCacheURL(t),this.xhr=Ti.Network.createHTTPClient(),this.method=e,this.xhr.open(e,t,!0),i=h.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return _(t,e),t.prototype.send=function(e){var t;return this._setUpCallbacks(e),t={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(h.Kii.logger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(h.Kii.logger("Error loading data..."),h.Kii.logger("callback : "+e),null!=e)return e.failure()}}(this),onError:function(){return function(){return h.Kii.logger("Error loading data..."),h.Kii.logger("callback : "+e),null!=e?e.failure():void 0}}(this)},this.xhr.onload=t.onComplete,this.xhr.onerror=t.onError,this.xhr.send()},t.prototype.sendData=function(e,t){var i;return this._setUpCallbacks(t),i={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(h.Kii.logger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(h.Kii.logger("Error loading data..."),null!=t)return t.failure()}}(this),onError:function(){return function(){return h.Kii.logger("Error loading data..."),h.Kii.logger("callback : "+t),null!=t?t.failure():void 0}}(this)},this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError,this.xhr.send(e)},t}(o),e=function(e){function t(e,t){var i,n,r;if(t=s._disableCacheURL(t),this.xhr=$.ajaxSettings.xhr(),this.xhr.open(e,t,!0),this.method=e,i=h.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return _(t,e),t}(o),h.KiiSCNQQ=function(e){function t(){this._unlinkFromCurrentUser=p(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=p(this._linkWithCurrentUser,this),this._logOut=p(this._logOut,this),this._logIn=p(this._logIn,this),this._unlink=p(this._unlink,this),this._link=p(this._link,this),this._register=p(this._register,this),this._setup=p(this._setup,this),t.__super__.constructor.call(this,h.KiiSocialNetworkName.QQ)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._register=function(e,t){var n,r,o,u,a;return a={accessToken:e.access_token,openID:e.openID},r=new Date,n=r.getTime(),h.Kii.getAccessTokenExpiration()>0&&(a.expiresAt=s._safeCalculateExpiresAtAsNumber(h.Kii.getAccessTokenExpiration(),n)),u=new i("/integration/qq",!0),u.setMethod("POST"),u.setData(a),u.setAnonymous(!0),u.setContentType("application/vnd.kii.AuthTokenQQRequest+json"),o={success:function(i){return function(o){var u,a,l;return i._setToken(e.access_token),u={access_token:e.access_token,openID:e.openID},i._setTokenObject(u),a=new h.KiiUser,a._updateWithJSON(o),a._setAccessToken(o.access_token),null!=o.expires_in&&(r=new Date,n=r.getTime(),l=s._safeCalculateExpiresAtAsDate(o.expires_in,n),a._setExpiresAt(l)),h.Kii.setCurrentUser(a),null!=t?t.success(h.KiiUser.getCurrentUser(),i._network):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(null,e._network,i):void 0}}(this)},u.execute(o,!1)},t.prototype._link=function(e,t){var n,r,s;return s=new i("/users/me/qq/link",!0),s.setMethod("POST"),n={accessToken:e.access_token,openID:e.openID},s.setData(n),r={success:function(i){return function(){var n;return i._setToken(e.access_token),n={access_token:e.access_token,openID:e.openID},i._setTokenObject(n),null!=t?t.success(h.KiiUser.getCurrentUser(),i._network):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(h.KiiUser.getCurrentUser(),e._network,i):void 0}}(this)},s.execute(r,!0)},t.prototype._unlink=function(e){var t,n;return t=new i("/users/me/qq/unlink",!0),t.setMethod("POST"),n={success:function(t){return function(){return t._setToken(null),t._setTokenObject(null),null!=e?e.success(h.KiiUser.getCurrentUser(),t._network):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(h.KiiUser.getCurrentUser(),t._network,i):void 0}}(this)},t.execute(n,!0)},t.prototype._logIn=function(e,i){if(t.__super__._logIn.call(this,e,i),h.Kii.logger("Checking options"),h.Kii.logger(e),null==e||!e.access_token&&!e.openID)throw h.InvalidArgumentException("Both options.access_token and options.openID are required");if(!e.access_token)throw h.InvalidArgumentException("options.access_token is required");if(!e.openID)throw h.InvalidArgumentException("options.openID is required");return null!=h.KiiUser.getCurrentUser()&&h.KiiUser.logOut(),this._register(e,i)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),h.Kii.logger("Log out qq")},t.prototype._linkWithCurrentUser=function(e,t){if(null==h.KiiUser.getCurrentUser())return void t.failure(null,this._network,"No user logged in");if(null==e||!e.access_token&&!e.openID)throw h.InvalidArgumentException("Both options.access_token and options.openID are required");if(!e.access_token)throw h.InvalidArgumentException("options.access_token is required");if(!e.openID)throw h.InvalidArgumentException("options.openID is required");return this._link(e,t)},t.prototype._unlinkFromCurrentUser=function(e){return null==h.KiiUser.getCurrentUser()?void e.failure(null,this._network,"No user logged in"):this._unlink(e)},t}(h.KiiSocialConnectNetwork),h.KiiServerCodeEntry=function(){function e(e,t){this.entryName=e,this.version=t}return e.prototype.execute=function(e,t){var i,n,r,o,a,l,c,p;if(!s._validateServerCodeEntryArgument(e))throw new h.InvalidArgumentException("arugment is invalid");return n=null!=e?e:{},a=null!=(p=this.version)?p:"current",i=JSON.stringify(n),o=h.Kii.getBaseURL()+"/apps/"+h.Kii.getAppID()+("/server-code/versions/"+a+"/"+this.entryName),l=u.createXHRWrapper("POST",o),c=l.xhr,c.setRequestHeader("x-kii-appid",h.Kii.getAppID()),c.setRequestHeader("x-kii-appkey",h.Kii.getAppKey()),c.setRequestHeader("x-kii-sdk",h.KiiSDKClientInfo.getSDKClientInfo()),c.setRequestHeader("Content-Type","application/json"),null!=h.KiiUser.getCurrentUser()&&c.setRequestHeader("Authorization","Bearer "+h.KiiUser.getCurrentUser().getAccessToken()),r={success:function(i){return function(){var n,r,s,o;o=c.getResponseHeader("X-Step-count");try{if(s=JSON.parse(c.responseText),r=new h.KiiServerCodeExecResult(s,o),null!=t)return t.success(i.entryName,e,r)}catch(u){if(null!=t)return n="fail to parse response. statusCode: "+c.status+" executedSteps: "+o+" error code: failed_to_parse_response response: "+c.responseText,t.failure(i.entryName,e,null,n)}}}(this),failure:function(i){return function(){var n,r,s,o;o=c.getResponseHeader("X-Step-count"),n={statusCode:c.status,executedSteps:o},r="fail to execute server code. statusCode: "+c.status+" executedSteps: "+o;try{if(s=JSON.parse(c.responseText),null!=s.errorCode&&(r+=" error code: "+s.errorCode),null!=s.message&&(r+=" message: "+s.message),null!=s.details&&null!=s.details.message)return r+=" detailMessage: "+s.details.message}catch(u){return r+=" error code: failed_to_parse_response message: "+c.responseText}finally{null!=t&&t.failure(i.entryName,e,null,r)}}}(this)},l.sendData(i,r)},e.prototype.getEntryName=function(){return this.entryName},e}(),h.KiiServerCodeExecResult=function(){function e(e,t){this.returnObject=e,this.exeSteps=t}return e.prototype.getExecutedSteps=function(){return this.exeSteps},e.prototype.getReturnedValue=function(){return this.returnObject},e}(),h};!function(){var t="undefined"!=typeof module&&null!==module;t&&module.exports?module.exports={exportedClasses:["KiiUser","KiiServerCodeExecResult","KiiAnyAuthenticatedUser","KiiEncryptedBucket","KiiAppAdminContext","KiiQuery","KiiSDKClientInfo","KiiACL","KiiSocialConnectNetwork","KiiBucket","KiiServerCodeEntry","KiiObjectAdmin","KiiSCNTwitter","KiiObject","Kii","KiiAnonymousUser","KiiSocialConnect","KiiGroup","KiiSCNQQ","ForTest","KiiACLAdmin","KiiGeoPoint","KiiGroupAdmin","KiiBucketAdmin","KiiUserAdmin","KiiEncryptedBucketAdmin","KiiClause","KiiACLEntry","KiiSCNFacebook","KiiSocialNetworkName","KiiSite","_KiiHttpRequestType","InvalidDisplayNameException","InvalidPasswordException","InvalidUsernameException","InvalidUserIdentifierException","InvalidEmailException","InvalidPhoneNumberException","InvalidLocalPhoneNumberException","InvalidCountryException","InvalidURIException","InvalidACLAction","InvalidACLSubject","InvalidACLGrant","InvalidLimitException","InvalidArgumentException","IllegalStateException","ArithmeticException","KiiACLAction"],create:function(){return e.call(this)}}:e()}()}();
